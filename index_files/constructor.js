"use strict";function asyncGeneratorStep(e,t,o,i,a,r,n){try{var s=e[r](n),d=s.value}catch(l){return void o(l)}s.done?t(d):Promise.resolve(d).then(i,a)}function _asyncToGenerator(e){return function(){var t=this,o=arguments;return new Promise(function(i,a){function r(e){asyncGeneratorStep(s,i,a,r,n,"next",e)}function n(e){asyncGeneratorStep(s,i,a,r,n,"throw",e)}var s=e.apply(t,o);r(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);t>o;o++)i[o]=e[o];return i}function _iterableToArrayLimit(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i,a,r=[],n=!0,s=!1;try{for(o=o.call(e);!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(d){s=!0,a=d}finally{try{n||null==o["return"]||o["return"]()}finally{if(s)throw a}}return r}}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}define("constructor",["_","jquery","jquery-ui-draggable","U","jquery-ui-resizable-bootstrap","widget","nf","waitall","enqueueAjax","history","lodash","asyncjs","i18n","logActions","linkPopover","typography","anchorPopup","constructor/HistoryActions","constructor/construct","constructor/events","constructor/settings","/js/ulib/block-100vh.js","colorThemeHelper","text!/html/constructor/headerFooterControls.html","text!./html/constructor/handlerBlock.html","autocrop","billing/feature-availability","device-canvas","ul-error","onboarding","/js/onboarding/popupsConf.js","blockingPopup","shop/shopAPI","ulLoader","js/edit/constructorHelpers","js/edit/constructorActions/main","panelPartials"],function(e,t,o,i,a,r,n,s,d,l,c,u,g,p,h,f,m,v,w,b,y,C,k,x,S,_,W,I,A,$,T,j,R,z,E,B){var P={isConstructor:!0,activeResize:!1,widgetGlobal:r,inited:!1,lastSessionId:0,STEP_GRID:8.33333333,COLS_LIMIT:12,blockClasses:["ul-container"],blockSettings:{},blocks:null,activeDrag:!1,activeAutocrop:!1,emptyContainerForHistory:{htmlContent:'<div id="UL_ID" class="ul-container"><div class="container js-block-container"></div></div>',widgets:{},content:{}},emptyContainer:{htmlContent:'<div id="UL_ID" class="ul-container"><div class="container js-block-container"><div id="UL_ID" class="row ul-row"><div id="UL_ID" class="ul-col col-md-12 col-xs-12 col-sm-12"></div></div></div></div>',widgets:{},content:{}},emptyContainerFluid:{htmlContent:'<div id="UL_ID" class="ul-container"><div class="container-fluid js-block-container"><div id="UL_ID" class="row ul-row"><div id="UL_ID" class="ul-col col-md-12 col-xs-12 col-sm-12"></div></div></div></div>',widgets:{},content:{}},init:function(e){var o=this;e||(e=function(){}),o.inited&&o.destroy(),window.siteCreationConstructorEntry&&i.params.isShowOnboardingInConstructor&&!this.inited&&$.init(T),j.init(i.params.allTariffsUrl,i.params.blockingPopupData),o.lastId=i.params.lastId,o.isTemplateMaster=i.params.isTemplateMaster,o.lastSessionId=0,o.inited=!0,window.UU.history=l,window.UU.widget=r,window.UU.constructor=o,o.resizeDeviceInit||(o.resizeWindowSetDevice(),o.onConstructorDevice(window.UU.constructor.deviceMode.device)),o.isDraggableWidget(window.UU.constructor.deviceMode.isPanelConstructorEditable),i.enqueueAjax=d,i.enqueueAjax.nf=n,u.map(i.params.widgetsIds,function(e,o){var a=window.widgetInfo[e.type].version,n=window.widgetVersion;return a==n.REACT||a==n.REACT_WRAPPER?o():"shop"!==i.params.pageType&&"special"!==i.params.pageType||"cart"!==e.type?t("#"+e.id).attr("data-widget")||"special"===i.params.pageType?void i.widget.factoryWidgetInstance(e.type,{id:e.id,$el:t(document.getElementById(e.id)),field:e.field,data:e.data,options:e.options,controls:e.controls},function(i){var a=t(document.getElementById(e.id));i.initView(e.id),r.renderElementControls(a),r.renderElementAnchor(a),o()}):o():void o()},function(){i.widget.setWidgetsCollectionFull()}),o.cecutient(),r.init({constructor:o,templateId:i.params.template,site:i.params.site,initWidgetsOnLoad:!0}),t("#ul-content",o.$body).children(".ul-container").length||"blog"===i.params.pageType||t("#ul-content",o.$body).html('<div class="container ul-drop-placeholder"><div class="ul-empty-ingorm"><div class="ul-empty-drag-help"></div> <p>'+g("constructor.Drag elements or block from the left panel")+"</p></div></div>"),"blog"!==i.params.pageType&&t.each(t(".ul-container",o.$body),function(e,o){0==t(o).find(".ul-col").children(".ul-widget").length?(t(o).attr("block-empty",!0),t(o).find(".ul-col").attr("data-description",g("constructor.Drag elements from the left panel"))):void 0==t(o).attr("block-empty")&&t(o).attr("block-empty",!1)}),o.addContainerHandler(t(".ul-container",o.$body)),o.posContainerHandler(),o.addHeaderFooterControll(),o.blocks||t.get("/sites/url/"+i.params.site+"/blocksList",function(e){o.blocks=e}),o._constructorEvents(),setTimeout(function(){o.parallax(),e()},1e3),t.each(t(".ul-container","#body-fict"),function(){var e=t(this);if("map"===e.attr("data-bgtype")){var i=null,a=t(".js-background-map",e);try{i=JSON.parse(e.attr("data-map-settings"))}catch(r){console.error("map settings JSON parse failed")}if(!i)return;a.length||(a=t('<div class="ul-background-block-map js-background-map"></div>').prependTo(e)),o.addBlockBackgroundMap(i,a)}if("video"===e.attr("data-bgtype")){var n=null,s=t(".ul-background-video-container",e);try{n=JSON.parse(e.attr("data-video-settings"))}catch(r){console.error("video settings JSON parse failed")}if(!n)return;s.length||(s=t('<div class="ul-background-video-container"><div class="ul-background-block-video js-background-video"></div></div>').prependTo(e)),o.addBlockBackgroundVideo(n,s)}}),""===i.params.yandexMapsApiKey&&i.params.yandexMapsApiKeyEnabled&&r.getWidgets(function(e){var o=Object.values(e).filter(function(e){return"maps"===e.type&&"yandex"===e.options.provider}),a=t('[data-bgtype="map"][data-map-settings*="yandex"]');if(o.length||a.length)try{var r="yandexMapsNoticeCounter_".concat(i.params.site),s=localStorage.getItem(r)||0;if(s=parseInt(s,10),3>s){var d=g("widgets.maps.no api key notice yandex");n.notify(d,"default",{useHtml:!0,timeout:1e4}),t.post("/sites/url/".concat(i.params.site,"/sendMapsApiNotice")),localStorage.setItem(r,s+1)}}catch(l){console.error("Error with localStorage : ",l)}}),t(document).off(".removeCard").on("pageRemoved.removeCard",function(){o.onProductCardRemoved()}).on("loadedCart.removeCard",function(){0===i.params.shop.productCardsQuantity&&i.params.shop.isActive&&o.__removeWidget(t("#ul-id-cart-0"),e,!0,!1)}),C.init(),o.initReactWidgets()},addHeaderFooterControll:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,a=this,r=function(e){var o=e.find(".ul-widget"),a=function(e){return JSON.parse(e.attr("data-device-hidden"))};return o.toArray().some(function(e){return a(t(e))[i.constructor.deviceMode.device]===!0})};t.each(t("header, footer",a.$body),function(a,n){var s=t(e.template(x)({__:g,title:g(t(n).is("header")?"constructor.blocksTypes.header":"constructor.blocksTypes.footer"),type:t(n).is("header"),pageType:i.params.pageType,device:i.constructor.deviceMode.device,hideWidgetDevice:r(t(n))}));o&&t(".ul-headerFooter-controls",t(this)).replaceWith(s),t(".ul-headerFooter-controls",t(this)).length||s.appendTo(t(n)),r(t(n))?t(".ul-headerFooter-handler",t(n)).addClass("ul-headerFooter-handler-has-extra"):t(".ul-headerFooter-handler",t(n)).removeClass("ul-headerFooter-handler-has-extra")})},initReactWidgets:function(){var e=this;t(window).off("typographyChange"),t(window).on("typographyChange",function(){f.fetch.then(function(e){window.dispatch(window.actions.setTypography(e))})}),window.signals.openLinkPopover.clear(),window.signals.openAnchorPopup.clear(),window.signals.closeLinkPopover.clear(),window.signals.openImageLib.clear(),window.signals.renderWidgetWrapped.clear(),window.signals.updateWidgetWrapped.clear(),window.signals.openWidgetSettings.clear(),window.signals.closeWidgetSettings.clear(),window.signals.destroyBlock.clear(),window.signals.destroyWidget.clear(),window.signals.showFatal.clear(),window.signals.copyWidget.clear(),window.signals.newHistory.clear(),window.signals.startMovingWidget.clear(),window.signals.movingWidget.clear(),window.signals.stopMovingWidget.clear(),window.signals.showDynamicText.clear(),window.signals.featureAvailability.clear(),window.signals.showNotAvailablePopup.clear(),window.signals.initGoals.clear(),window.signals.destroyGoals.clear();var o=null,a=null;window.signals.openLinkPopover.listen(function(e){return new Promise(function(i){o&&e.key===a?o.destroy():o&&(a=null,o.destroy());var r=t.extend({scrollTop:t("#ul-main").scrollTop(),leftContainer:t(e.selector).offset().left},e.rect);a=e.key,o=new h({$target:t(e.selector),rect:r,href:e.url,types:e.types||["outer","inner","orderForm"],type:e.type,newWindow:"_blank"===e.target,gravity:e.gravity,removeBtn:!0,apply:function(e){window.dispatch(window.actions.applyLink(e.href,e.pageTitle,e.newWindow?"_blank":"_self",e.type))}}),o.show({$target:t(e.selector),rect:r,onAfterOpen:function(){e.url||o._switchPage("edit","inner")}}),i()})}),window.signals.openAnchorPopup.listen(function(e){return new Promise(function(o){var a=e.el,r=e.id,n=e.widget,s=i.params.pages.find(function(e){return e.id===i.params.pageId})._id;m.show({$target:t(a),anchor:n.anchor,afterAddingAnchor:function(e){l.pushAndExec({act:"setWidgetAnchor",data:{widgetId:r,pageId:s,oldWidgetAnchor:n.anchor,newWidgetAnchor:e}})}}),o()})}),window.signals.closeLinkPopover.listen(function(){return new Promise(function(e){o&&(a=null,o.destroy(),o=null),e()})}),window.signals.openImageLib.listen(function(){return new Promise(function(e){require(["imagelib"],function(t){t.open({multiSelect:!1,apply:function(t){var o=_slicedToArray(t,1),i=o[0].origin;e(i)},close:function(){e()}})})})}),window.wrapedWidgets=[],window.signals.renderWidgetWrapped.listen(function(e){var o=e.id,a=e.type,r=e.data,n=e.opts;return new Promise(function(e){var s=t("#".concat(o,"-inner"));s.empty(),i.widget.factoryWidgetInstance(a,{id:o,$el:s,controls:"mer"},function(t){r&&(t.data=r,t.synced=!0),n&&(t.options=n),t.addBlockWidget=!1,window.wrapedWidgets[o]=t,t.render(e)})})}),window.signals.updateWidgetWrapped.listen(function(e){var t=e.id,o=e.data,i=void 0===o?{}:o,a=e.opts,r=void 0===a?{}:a,n=e.mediaParams,s=void 0===n?{}:n;return new Promise(function(e){var o=window.wrapedWidgets[t];Object.assign(o.data,i),Object.assign(o.options,r),o.mediaParams||(o.mediaParams={}),Object.assign(o.mediaParams,s),o.render(e)})});var r=function(e,o){e.proto.overlay.show({$el:t("#"+o),autohide:!1}),e.proto.overlay.$el.one("click",function(){return window.dispatch(window.actions.exitWidget())}),t(".js-main").on("click.overlayEvents",function(e){t(e.target).hasClass("js-main")&&window.dispatch(window.actions.exitWidget())})};window.signals.showWidgetOverlay.listen(function(e){return new Promise(function(o){require(["widget"],function(i){r(i,e),t("#ul-left-menu").append('\n						<div class="js-fake-panel"\n							style="'.concat(["position: absolute","left: 0","top: 0","width: 100%","height: 100%","z-index: 99"].join("; "),';"\n						>\n						</div>\n					')),t(".js-fake-panel").one("click",function(){return window.dispatch(window.actions.exitWidget())}),o()})})}),window.signals.openWidgetSettings.listen(function(e){return new Promise(function(t){require(["panelDialog","widget"],function(o,i){r(i,e),o.show({data:"",noScroll:!0}),t()})})});var s=!1;window.signals.showDynamicText.listen(function(e){return new Promise(function(o){require(["dynamicText"],function(i){s&&i.deinit(),i.init(t("#".concat(e," .js-wy-popup-dock"))),i.show(),s=!0,o()})})}),window.signals.closeWidgetSettings.listen(function(){return new Promise(function(e){require(["panelDialog","widget"],function(o,i){i.proto.overlay.hide();var a=t(".js-fake-panel");a.length?a.remove():o.hide(),e()})})}),window.signals.destroyBlock.listen(function(t,o){return new Promise(function(i){e.__realRemoveBlockWithWidgets.bind(e,o).apply(null,t),i()})}),window.signals.destroyWidget.listen(function(t){return new Promise(function(o){e.__realRemoveWidget.apply(e,t),o()})}),window.signals.showFatal.listen(function(){return new Promise(function(e){window.cache&&(!window.cache||window.cache.isPublished)||/\.[\w]+\/preview\//.test(window.location.href)||t("#iframe-preview").length||(window.analyticsHandler&&[["yandexMetrika.nfErrors","hit",window.location.href],["googleUniversalAnalytics.nfErrors",null,"nfErrors.send","pageview"]].forEach(function(e){window.analyticsHandler.apply(null,e)}),window.constructorMode&&n.confirm({title:g("all.ajaxError.title"),text:g("all.ajaxError.text"),ok:g("all.ajaxError.okBtnText"),okCb:function(){window.location.reload()}})),e()})}),window.signals.copyWidget.listen(function(o,i){return new Promise(function(a){i.$el=t("#"+o),i.controls="mer",i.options=i.opts,delete i.opts,e.copyWidget(i.$el.closest(".ul-row"),i,a)})}),window.signals.newHistory.listen(function(){return new Promise(function(e){l.pushAndExec({act:"newHistory"},e)})}),window.signals.startMovingWidget.listen(function(o){return new Promise(function(a){var r=t("#".concat(o.id));i.page.startDrop("widget",o.type),e.$body.attr("data-controls","drag"),r.closest(".ul-widget").addClass("ul-el-drag-mask ul-visible-handler"),e.$body.find(".ul-container").css("z-index","auto"),i.menu.$el.css("z-index",1),e.activeDrag=!0,t("html").css("overflow-x","hidden"),t(document).trigger("showDropArea"),a()})});var d;window.signals.movingWidget.listen(function(e){return new Promise(function(t){d=e,i.page.hover(e.x,e.y,"widget",e.type,e.id),i.page.autoScrollIframeDragReact(e.y),t()})}),window.signals.stopMovingWidget.listen(function(o){return new Promise(function(a){var r=t("#".concat(o.id)),n=r.closest(".ul-col");if(i.page.stopAutoscroll(),i.menu.$el.css("z-index",""),t("html").css("overflow-x","auto"),e.activeDrag=!1,e.$body.find(".ul-container").css("z-index",""),t(document).trigger("hideDropArea"),r.closest(".ul-widget").removeClass("ul-visible-handler"),!d)return i.page.stopDrop(),a({isRemove:!1});i.page.hover(d.x,d.y,"widget",d.type,d.id),i.page.hoverDebouncer.triggerImmediateIfNeed(),d=null,r.closest(".ul-widget").removeClass("ul-el-drag-mask");var s=!1;if(i.page.$dropTarget.hasClass("ul-drop-remove"))s=!0;else{e.dragDrop(r,i.page.$dropTarget,n);var l=r.closest(".ul-row").children();e.setResizeCol(l)}i.page.stopDrop(),e.$body.removeAttr("data-controls"),a({isRemove:s})})}),window.signals.featureAvailability.listen(function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;t>i;i++)o[i-1]=arguments[i];return new Promise(function(t){var i=["check","getFeatureMintariff"];return i.includes(e)?W[e].apply(W,o.concat([function(){for(var e=arguments.length,o=new Array(e),i=0;e>i;i++)o[i]=arguments[i];return t(o)}])):void t(W[e].apply(W,o))})}),window.signals.showNotAvailablePopup.listen(function(e,t){return new Promise(function(o){o(W.showNotAvailablePopup(e,t))})}),window.signals.orderFormModel.listen(function(e){for(var o=arguments.length,a=new Array(o>1?o-1:0),r=1;o>r;r++)a[r-1]=arguments[r];return new Promise(function(o){var r=["add","copy","reorder","edit","remove","list","get","getFromImportaed","openPreviewMode"];require(["model/orderForm","orderForm"],function(s,d){if(r.includes(e)){if("edit"===e||"openPreviewMode"===e){var l=a[0],c=a[1];return d[e](l,c,function(){window.dispatch(window.actions.setPopupInEditing(!1));for(var e=arguments.length,t=new Array(e),i=0;e>i;i++)t[i]=arguments[i];o(t)})}if("copy"===e){var u=a[0],p=a[1],h=a[2],f=i.generateTitle(p,h,g("constructor.orderForm.copy"));return s.copy(u,f,function(){window.dispatch(window.actions.setPopupInEditing(!1));for(var e=arguments.length,t=new Array(e),i=0;e>i;i++)t[i]=arguments[i];o(t)})}return"remove"===e?void n.confirm({title:g("constructor.linkPopover.title alert orderForm remove"),text:g("constructor.linkPopover.text alert orderForm remove"),ok:g("constructor.linkPopover.btn alert orderForm remove"),cancel:"",color:"ul-button-red",cancelCb:function(){t("#body-fict").css("pointer-events","")},okCb:function(){s[e].apply(s,a.concat([function(){for(var e=arguments.length,t=new Array(e),i=0;e>i;i++)t[i]=arguments[i];return o(t)}]))}}):s[e].apply(s,a.concat([function(){for(var e=arguments.length,t=new Array(e),i=0;e>i;i++)t[i]=arguments[i];return o(t)}]))}o(s[e].apply(s,a))})})}),window.signals.initGoals.listen(function(e){return new Promise(function(o){var a=t("#js-goals-settings-from-old-code-".concat(e)),r="special"!==i.params.pageType&&e&&a;return r?void require(["promise!goals"],function(t){t.init({$target:a,entityType:"widgetReact",entityId:e}),o()}):o()})}),window.signals.destroyGoals.listen(function(e){return new Promise(function(e){require(["promise!goals"],function(t){return"special"===i.params.pageType?e():(t.destroy(),void e())})})})},offAndFadeContainerEdit:function(e){e.attr("data-offEditAndFade",!0)},onAndFadeContainerEdit:function(e){e.removeAttr("data-offEditAndFade")},saveRemoveHeaderFooter:function(o,a,r,n){var s=this;if(n){var d=o.prop("tagName").toLowerCase(),c=a[d]?"addClass":"removeClass";t.ajax({url:"/sites/url/".concat(i.params.site,"/removeHeaderFooter"),method:"PUT",data:{isRemove:a},success:function(){o[c]("element-".concat(d,"-removed")),i.params.isRemove[d]=a[d],!r&&a[d]&&t(window).trigger("removeHeaderFooter",d),s.posContainerHandler()},error:function(e){throw new Error(e)}})}else l.pushAndExec({act:"removeHeaderFooter",data:{type:o.prop("tagName").toLowerCase(),"new":{isRemove:e.extend({},a)},old:{isRemove:e.extend({},i.params.isRemove)},isForse:r}})},removeHeaderFooter:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};p.add({file:"js/edit/constructor.js",title:"removeHeaderFooter"}),this.saveRemoveHeaderFooter(e,t,o.isForse,o.ignoreHist)},restoreHeaderFooter:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};p.add({file:"js/edit/constructor.js",title:"restoreHeaderFooter"}),this.saveRemoveHeaderFooter(e,t,o.isForse,o.ignoreHist)},moveBlockToSiteBlank:function(o){require(["text!/html/constructor/blockPreview.html"],function(a){t.ajax({api:!0,type:"post",url:i.sprintf("/api/blanks/site/{site}/page/{page}/moveBlock/{blockId}",[i.params.site,i.params.page,o]),ok:function(r){var s=i.params.page.replace(/^blocks_/,""),d=s+"_"+o,l=t('.js-block[data-id="'+d+'"]'),c=r.replace(/views/,""),u=e.template(a),g=u({block:{id:d,preview:c+"?v="+Math.random()},key:s});l.length>0?l.replaceWith(g):t('.js-panel-constructor-blocks-list[data-category="'+s+'"]').append(g),n.notify("block move success")},noOk:function(){n.notify("block move Error","error")}})})},addContainerHandler:function(o){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,r=this,n={blocks_headers:!0,blocks_content:!0,blocks_thematic:!0,blocks_contacts:!0};setTimeout(function(){var s=["shop:success","shop:checkout","infoPage:userAgreement","infoPage:privacyPolicy"];o.each(function(){var o=this,d=t(this).hasClass("ul-floating"),l=t(this).hasClass("ul-symbol"),c=r.getContainerName(t(this)),u=g("constructor.hidden block"),p=!1,h=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.decor")},{"class":"settings",event:"settings",title:g("constructor.block-settings.structure")}],[{"class":"actions",event:"actions",title:g("constructor.block-settings.actions")}]],f=!0;~s.indexOf(t(this).data("behavior"))&&(f=!1,h=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.decor")}]]),"product:productDetail"===t(this).data("behavior")&&(h=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.decor")},{"class":"settings",event:"settings",title:g("constructor.block-settings.structure")}],[{"class":"actions",event:"actions",title:g("constructor.block-settings.actions")}]]),"ul-id-special-404_block"===t(this).attr("id")&&(f=!1,h=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.decor")},{"class":"settings",event:"panel",additional:"404"}]]);var m=t(this).data("symbol")&&t(this).data("symbol").enabled&&!i.params.pageIsEditable;if(m&&(f=!1,h=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.decor")},{"class":"settings",event:"settings"}],[{"class":"cross-big",event:"remove"}]]),"desktop"!==i.constructor.deviceMode.device&&i.params.pageIsEditable){h=[[{"class":"background",event:"backgroundSettings",title:g("constructor.block-settings.decor "+i.constructor.deviceMode.device)},{"class":"eye-close",event:"hide",title:g("constructor.block-settings.hide "+i.constructor.deviceMode.device)},{"class":"eye",event:"hide",title:g("constructor.block-settings.show")},{"class":"undo",event:"restoreWidgets",title:g("constructor.block-settings.restore widgets")}]];var v=function(){var e=t(o).find(".ul-widget"),a=function(e){return e.attr("data-device-hidden")?JSON.parse(e.attr("data-device-hidden")):void 0};return e.toArray().some(function(e){var o=a(t(e));return o?o[i.constructor.deviceMode.device]===!0:void 0})};v()&&(p=!0,t(".ul-block-handler",t(this)).addClass("ul-block-handler-has-extra"))}p===!1&&t(".ul-block-handler",t(this)).removeClass("ul-block-handler-has-extra");var w;W.check("customClasses",{showPopupIfNotAvailable:!1},function(e){if(e){var i=t(o).attr("data-custom-classes");try{i&&(w=JSON.parse(i))}catch(a){A.sendErrorOnServer({msg:"Error during data-custom-classes parse",error:a})}}});var b,y=t(this).attr("data-options");try{y&&(b=JSON.parse(y).anchor)}catch(C){A.sendErrorOnServer({msg:"Error during data-options parse",error:C})}var k=t(e.template(S)({isTemplateMaster:i.params.isTemplateMaster,isServicePage:n[i.params.page],device:i.constructor.deviceMode.device,hasRestoreButton:p,floatingEnabled:d,controls:h,drag:f,ulContainerName:c,ulContainerHiddenName:u,anchor:b,customClasses:w,symbolEnabled:l,__:g}));return a?void t(".ul-block-controls",t(this)).replaceWith(k):void(t(".ul-block-controls",t(this)).length||k.appendTo(t(this)))})},0)},getContainerName:function(e){return g(e.find(".ul-widget").length?"ul-id-special-404_block"===e.attr("id")?"constructor.block404":"constructor.block":"constructor.empty block handler name")},posContainerHandler:function(){var e=i.constructor.deviceMode.device,o=t("header").hasClass("element-header-removed"),a=t("header[data-device-hidden*='\"".concat(e,"\":true']"));if(t(".js-first-visible-container").removeClass("ul-first-visible-container js-first-visible-container"),a.length||o){var r=t(".ul-container").first();i.params.isHiddenDeviceBlock||(r=t(".ul-container:not([data-device-hidden*='\"".concat(e,"\":true'])")).first()),-1!==r.index()&&(i.params.firstVisibleContainer=r.index(),r.addClass("ul-first-visible-container js-first-visible-container"))}},__addBlock:function(e,o,a,r,n){var s=this,d=null,l={desktop:!1,tablet:!1,phone:!1};a||(a=function(){}),d="block-empty-fluid"===e?s.emptyContainerFluid:"block-empty"===e?s.emptyContainer:"block-empty-for-history"===e?s.emptyContainerForHistory:s.blocks[e];var c=d.htmlContent,p=r?r:s.getId(),h={lastId:s.lastId,lastSessionId:s.lastSessionId},f=p.match(/ul\-id\-(\d+)\-(\d+)/);f[1]=parseInt(f[1]),f[2]=parseInt(f[2]),s.lastId=f[1],s.lastSessionId=f[2],c=c.replace(/UL_ID/g,s.getId.bind(s)),n||(s.lastId=h.lastId,s.lastSessionId=h.lastSessionId),t("#ul-content").find(".ul-drop-placeholder").length&&t("#ul-content").find(".ul-drop-placeholder").remove();var m=s._addBlock(c,t("#ul-content"),o);if(void 0===m.attr("data-device-hidden")&&m.attr("data-device-hidden",JSON.stringify(l)),m.addClass("hidden-elements-device"),m.addClass("js-hidden-device-element"),m.attr("data-device-hidden")||m.attr("data-device-hidden",'{"desktop":false,"phone":false,"tablet":false}'),m.attr("data-behavior")||m.attr("data-behavior","none"),m.attr("data-options")||m.attr("data-options",d.content.params?JSON.stringify(d.content.params):"{}"),m.attr("id")&&d.content.params)s.setBlockSettingsBackground(m.attr("id"),d.content.params),s.setBlockSettingsStructure(m.attr("id"),d.content.params);else if("block-empty"===e||"block-empty-fluid"===e&&m.attr("id")&&!d.content.params){var v=t("#body-fict").attr("data-block_theme"),w=k.getBlockTheme("",v),b="";w.split(" ").includes("g-theme-block-0")&&(b=w.split(" ")[1]);i.params.pages.find(function(e){return e.id===i.params.pageId})._id;b=b||"g-theme-block-1","g-theme-block-5"===v&&(b="g-theme-block-0");var y={desktop:b,tablet:b,phone:b};m.addClass(k.getBlockTheme("",v)).attr("data-theme","g-theme-block-0").attr("data-theme-block",JSON.stringify(y)),s.setBlockShadow(m.attr("id")),y.desktop={theme:b,transparent:!0,background:{overlay:{color:"transparent",opacity:.25}}},s.updateParamsBackgroundState(m.attr("id"),y.desktop,"desktop",!0)}return u.mapSeries(m.find(".ul-widget").toArray(),function(e,o){var i=t(e),a=i.data("id"),r=i.closest(".ul-col"),n=i.data("widget"),l=i.attr("id");i.remove(),s.__addWidget({id:l,noSave:!0,dropId:r.attr("id"),widgetType:n,data:d.widgets[a].data,options:d.widgets[a].opts,blockAdd:!0,autocrop:!1,index:0,mediaParams:d.widgets[a].mediaParams},o())},function(){s.save({act:"addBlock",blockId:e,index:o,lastId:f[1],lastSessionId:f[2]}),a()}),"block-empty"!=e&&"block-empty-fluid"!=e||(m.find(".ul-col").attr("data-description",g("constructor.Drag elements from the left panel")),m.attr("block-empty",!0),m.attr("data-auto_height",!0),m.attr("data-is-100vh-enabled",!1),m.attr("data-custom-classes","[]"),m.css("padding-top","50px"),m.css("padding-bottom","50px")),s.addContainerHandler(m),m.index()<=i.params.firstVisibleContainer&&s.posContainerHandler(),t(window).trigger("addElelment"),m},addBlock:function(e,t,o){var i=this;return p.add({fromFile:"js/edit/constructor.js",title:"addBlock",desc:"addBlock: "+e}),l.pushAndExec({act:"addBlock",data:{id:i.getId(),blockId:e,index:t}},o)},__copyBlock:function(e,o,a){var n=this,s=t("#"+e.originalId);n.destroyResizable(s);var d=s.clone();t.each(d.find(".ul-widget"),function(){t(this).empty()}),d.removeAttr("block-empty"),d.removeAttr("data-auto_height"),d.removeClass("ui-draggable").find(".ul-block-controls-visible").removeClass("ul-block-controls-visible"),s.removeClass("ui-draggable").find(".ul-block-controls-visible").removeClass("ul-block-controls-visible").find('.js-block-btn[data-event="copy"]').trigger("mouseleave");var l=d.prop("outerHTML").replace(/\n/gim,"");d.remove();var c=e.id?e.id:n.getId(),g={lastId:n.lastId,lastSessionId:n.lastSessionId},p=c.match(/ul\-id\-(\d+)\-(\d+)/);p[1]=parseInt(p[1]),p[2]=parseInt(p[2]),n.lastId=p[1],n.lastSessionId=p[2],l=l.replace(/ul-id-(\d+)-(\d+)/g,function(){return n.getId()}),a||(n.lastId=g.lastId,n.lastSessionId=g.lastSessionId);var h=n._addBlock(l,t("#ul-content"),e.index),f=0;return u.map(h.find(".ul-widget").toArray(),function(e,o){var i=t(e),a=i.attr("id"),d=t(s.find(".ul-widget").toArray()[f]).attr("id"),l=r.get(d),c=i.closest(".ul-col").attr("id");f+=1,i.remove();var u=l.type,g={},p={};t.extend(!0,g,l.data),t.extend(!0,p,l.options),n.isSingleWidgetPage(u)&&(u="spacer",g={},p={});var h=0;t.each(l.$el.parent().children(".ul-widget"),function(e){h=e}),n.__addWidget({id:a,noSave:!0,dropId:c,widgetType:u,data:g,options:p,index:h,autocrop:!1,blockAdd:!0},function(){o()})},function(){n.copy=!1,n.save({act:"copyBlock",originalId:e.originalId,index:e.index,id:e.id||h.attr("id"),lastId:p[1],lastSessionId:p[2]}),h.offset().top+t("#ul-main").scrollTop()+h.height()>t(window).height()+t("#ul-main").scrollTop()&&t("#ul-main").animate({scrollTop:h.offset().top+t("#ul-main").scrollTop()-(t("#ul-main").offset().top+37)}),n.addContainerHandler(h),h.index()<=i.params.firstVisibleContainer&&n.posContainerHandler(),t(window).trigger("addElelment"),o()}),h},__lockBlock:function(e,o,i){var a=t("#"+e);if(!a.length)return a;var r=a.find(".js-block-lock");return o&&!r.length?(a.css("overflow","hidden"),a.append('<div class="js-block-lock ul-block-lock"></div>')):!o&&r.length&&(r.remove(),a.css("overflow","")),i(),a},lockBlock:function(e,t,o){var i=e.attr("id");return p.add({file:"js/edit/constructor.js",title:"lockBlock"}),l.pushAndExec({act:"lockBlock",data:{id:i,isLocked:t}},o)},copyBlock:function(e,t){var o=this;return o.copy=!0,p.add({file:"js/edit/constructor.js",title:"copyBlock"}),l.pushAndExec({act:"copyBlock",data:{id:o.getId(),blockId:"blockId",originalId:e.attr("id"),index:e.index()+1}},t)},createBlockFromBlockJSON:function(e,t){return p.add({file:"js/edit/constructor.js",title:"createBlockFromBlockJSON"}),l.pushAndExec({act:"createBlockFromBlockJSON",data:this.generateBlockIds(e)},t)},generateBlockIds:function(e){var t=this,o=function(e){return"UL_ID"===e?t.getId():e};return e.block.id=o(e.block.id),e.block.rows.map(function(e){e.id=o(e.id),e.cols.map(function(e){e.id=o(e.id),e.widgets.map(function(e){e.id=o(e.id)})})}),e},generateBaseBlockHTML:function(e){var o="",i=this,a=t("#ul-content"),r=e.block.classes?e.block.classes.slice():[],n=[];r.push("ul-container hidden-elements-device js-hidden-device-element",e.block.params.theme),o=t("<div>",{id:e.block.id,"class":r.join(" "),"data-theme":e.block.params.theme,"data-options":JSON.stringify(e.block.params),"data-auto_height":e.block.params.justifyHeight,"data-parallax":e.block.params.background.parallax,"data-device-hidden":'{"desktop":false,"phone":false,"tablet":false}'}),t(".ul-drop-placeholder",a).length&&t(".ul-drop-placeholder",a).remove();var s=i._addBlock(t(o).get(0),a,e.index||0);"parallax"===e.block.params.background.parallax&&t('<div class="ul-background-block-image-section"><div class="ul-background-block-image-section-inner"><div class="ul-background-block-image js-background-parallaximage parallax"></div></div></div>').appendTo(s);var d=t("<div>",{"class":(e.block.params.fluid?"container-fluid ":"container ")+"js-block-container"}).appendTo(s);return e.block.params.offset||d.addClass("ul-container-no-padding"),this.setBlockSettingsBackground(s.attr("id"),e.block.params),this.setBlockSettingsStructure(s.attr("id"),e.block.params),e.block.rows.forEach(function(e,t){var o=i._addRow(e.id,d,t);e.cols.forEach(function(e,t){e.$el=i._addCol(e.id,o,t,!1),e.widgets.map(function(e,t){return e.__index=t,e}),n.push(e)})}),{cols:n,$container:d,$block:s}},_createBlockFromBlockJSON:function(o,a){var r,n=this,s=this.generateBaseBlockHTML(o),d=s.$container;return r=function(e,t,o,i){"productCard"===e.type&&(e.data=null);var a={id:e.id,noSave:!0,noColSizeSmartAdjust:!0,dropId:t.id,widgetType:e.type,data:e.data,options:e.opts,index:e.__index,blockAdd:!0};e.mediaParams&&(a.mediaParams=e.mediaParams),n.__addWidget(a,function(){n._setColSize(o,null,t.size),i()})},u.each(s.cols,function(e,t){u.each(e.widgets,function(t,o){n.isSingleWidgetPage(t.type)&&(t.type="spacer",t.data={},t.opts={}),"customHtml"===t.type?W.check("customHtml",{showPopupIfNotAvailable:!1},function(i){i||(t.data.code=""),r(t,e,e.$el,o)}):r(t,e,e.$el,o)},function(e){return e?void console.error(e):void t()})},function(r){if(r)return void console.error(r);n.save({act:"createBlockFromBlockJSON",data:e.extend({},o,{index:o.index||0,lastId:n.lastId,lastSessionId:n.lastSessionId})}),n.addContainerHandler(s.$block),s.$block.index()<=i.params.firstVisibleContainer&&n.posContainerHandler(),t(window).trigger("addElelment");var l=t("#ul-main");d.offset().top+l.scrollTop()+d.height()>t(window).height()+l.scrollTop()&&l.animate({scrollTop:d.offset().top+l.scrollTop()-(l.offset().top+37)
}),a&&a()}),d},_makeBlockSymbol:function(t,o){this.setBlockSymbol(t),z.show({isBlurring:!0,isShowPanel:!0,isShowProgressBar:!1,title:"constructor.title"}),this.save({act:"makeBlockSymbol",data:e.extend({},t,{index:t.index||0,lastId:this.lastId,lastSessionId:this.lastSessionId}),symbolAction:!0},function(){return E.softReload(function(){return z.hide()})}),o&&o()},_unmakeBlockSymbol:function(t,o){z.show({isBlurring:!0,isShowPanel:!0,isShowProgressBar:!1,title:"constructor.title"}),this.save({act:"unmakeBlockSymbol",data:e.extend({},t,{index:t.index||0,lastId:this.lastId,lastSessionId:this.lastSessionId}),symbolAction:!0},function(){return E.softReload(function(){return z.hide()})}),o&&o()},__addCol:function(e,o,i,a){var r,n=this,s={act:"addCol",to:e.hasClass("ul-row")?e.attr("id"):e.parent().attr("id"),id:a?a:n.getId(),index:o};return a.match(/special/)?r?t('<div id="'+s.id+'" class="ul-col ul-absolute-widgets"></div>').appendTo(t("#ul-main #body-fict")):!1:(r=n._addCol(s.id,e,o,i))?(n.save(s),r):!1},addCol:function(e,o,i){var a=this,r=a.getId(),n=e.attr("id"),s=n,d=a._dumpColSizesOfRow(t("#"+s));return p.add({fromFile:"js/edit/constructor.js",title:"addCol",desc:"id: "+r}),l.pushAndExec({act:"addCol",data:{id:r,dropId:n,rowId:s,colSizes:d,index:o,moveWidget:i}})},__addRow:function(e,t,o){var i=this,a={act:"addRow",to:e.closest(".ul-container").attr("id"),id:o?o:i.getId(),index:t},r=i._addRow(a.id,e,t);return i.save(a),r},addRow:function(e,t){var o=this,i=o.getId(),a=e.attr("id");return p.add({fromFile:"js/edit/constructor.js",title:"addRow",desc:"id: "+i}),l.pushAndExec({act:"addRow",data:{id:i,dropId:a,ulContainerId:e.closest(".ul-container").attr("id"),index:t}})},__addWidget:function(e,o,a){var r=this;if(!e.dropId)return!1;var n=t("#"+e.dropId);if(0===n.length&&!e.dropId.match(/special/))return!1;if(!n.hasClass("ul-absolute-widgets")&&(void 0!=n.attr("data-description")&&void 0!=n.closest(".ul-container").attr("block-empty")||0!=n.closest(".ul-container").attr("block-empty")&&"false"!=n.closest(".ul-container").attr("block-empty"))&&(n.removeAttr("data-description"),n.closest(".ul-container").children(".ul-block-controls").find(".ul-block-title").text(g("constructor.block")),!I.getBlockSetting(n.closest(".ul-container").attr("id"),i.constructor.deviceMode.device))){var s=k.getBlockTheme("",t("#body-fict").attr("data-block_theme"));r.setBlockSettingsBackground(n.closest(".ul-container").attr("id"),{theme:s,background:{overlay:""}})}var d={act:"addWidget",to:n.attr("id"),id:e.id,index:e.index,anchor:e.anchor||null,widget:e.widgetType,noSave:e.noSave};if(n.hasClass("ul-absolute-widgets")){d.act="addAbsWidget";var l=null;l=n.hasClass("ul-position-absolute-bottom")?"bottom":n.hasClass("ul-position-absolute-center")?"center":n.hasClass("ul-position-absolute-top")?"top":"special",d.data={party:n.data("position"),position:l}}var c;if(window.widgetInfo[e.widgetType].version==window.widgetVersion.REACT||window.widgetInfo[e.widgetType].version==window.widgetVersion.REACT_WRAPPER){var u=2,p=function(){u--,0===u&&e.forceSave&&window.dispatch(window.actions.silentSaveWidget(d.id))};c=r._addReactWidget(d.id,d.widget,n,e.index),c.attr("data-device-hidden",JSON.stringify({desktop:!1,tablet:!1,phone:!1})),d.noSave||r.save(d,p),o=o||function(){};var h=function(){r._smartAdjustColSizesOfRow({$row:c.closest(".ul-row"),autocrop:e.notSmartAdj?!e.notSmartAdj:e.autocrop,cb:o})};return setTimeout(function(){e.noColSizeSmartAdjust?o&&o():h&&h(),window.dispatch(window.actions.createWidget(r.formatWidgetDataToReact(e))),p()},0),c}return c=r._addWidget(d.id,d.widget,n,e.index,d.anchor),d.noSave||r.save(d),i.widget.factoryWidgetInstance(d.widget,{id:d.id,$el:c,controls:"mer"},function(i){if(e.data&&(i.data=e.data,i.synced=!0),e.anchor&&(i.anchor=e.anchor),e.options&&(i.options=e.options),e.forceSave&&i.save(),i.addBlockWidget=e.blockAdd?e.blockAdd:!1,n.hasClass("ul-absolute-widgets"))i.render(function(){o&&o(i)});else{o||(o=function(){});var s=function(t){r._smartAdjustColSizesOfRow({$row:t.$el.closest(".ul-row"),autocrop:e.notSmartAdj?!e.notSmartAdj:e.autocrop,cb:o})};i.render(function(){if("imagezoom"===i.type){if((e.notSmartAdj?!e.notSmartAdj:e.autocrop)!==!1)if(a)if(n.closest(".ul-row").find(".ul-col").length<2)_.setHeight(i.$el,400);else{var d=n.closest(".ul-row").height(),l=n.find(".ul-widget");l.outerHeight(function(e,t){d-=t},!0),l.length>1&&"false"==n.closest(".ul-container").attr("data-auto_height")&&(d+=i.$el.outerHeight(!0)/2),_.setHeight(i.$el,200>d?200:d>700?700:d)}else _.setHeight(i.$el,"auto"),_.setImmediate(i.$el)}else"gallery2"!==i.type||"grid"!==i.options.type||e.notSmartAdj||!e.autocrop||a||(_.setHeight(i.$el,"auto"),_.setImmediate(i.$el));"productCard"===e.widgetType?r.onProductCardAdded(s,i):e.noColSizeSmartAdjust?o&&o(i):s&&s(i),t(window).trigger("addElelment")})}}),"addAbsWidget"==d.act&&t(window).trigger("absWidget",{active:!1,wtype:d.widget}),e.isSingleWidget&&(r.singleWidgets.push(d.widget),t(window).trigger("singleWidget",{active:!1,wtype:d.widget})),c},onProductCardRemoved:function(e){var o=this;e=e?e:function(){},0===i.params.shop.productCardsQuantity?i.params.shop.isActive&&o.__removeWidget(t("#ul-id-cart-0"),e,!0,!1):e()},onProductCardAdded:function(e,o){var a=this;if(e=e||function(){},i.params.shop.productCardsQuantity++,i.params.shop.isActive||(i.params.shop.isActive=!0,i.params.isShopPagesLoadNeeded=!0,t(window).trigger("shopCreated")),r.widgetsCollection["ul-id-cart-0"])e(o),t(document).trigger("draggableWidgetDisabled",["productCard",!1]);else{var n={widgetType:"cart",id:"ul-id-cart-0",isSingleWidget:!1,noColSizeSmartAdjust:!1,index:0,dropId:"special-7"};a.__addWidget(n,function(){e(o),t(document).trigger("draggableWidgetDisabled",["productCard",!1])})}},__copyWidget:function(e,o){var a=this;if(!e.dropId)return!1;o=o||function(){};var r=t("#ul-main"),n=t("#body").attr("data-controls");t("#body").attr("data-controls","drag");var s,d=t("#"+e.dropId),l={act:"copyWidget",to:d.attr("id"),id:e.id,index:e.index,widget:e.widgetType,originalId:e.originalId,noSave:e.noSave,controls:e.controls};if(window.widgetInfo[e.widgetType].version){s=a._addReactWidget(l.id,l.widget,d,e.index),s.attr("data-device-hidden",JSON.stringify({desktop:!1,tablet:!1,phone:!1})),l.noSave||a.save(l);var c=function(){a._smartAdjustColSizesOfRow({$row:s.closest(".ul-row"),cb:o})};return c&&c(),t.each(t("#"+e.originalId).closest(".ul-row").find(".ul-widget"),function(){t(this).css({overflow:""})}),s.closest(".ul-row").offset().top+r.scrollTop()+s.closest(".ul-row").height()>t(window).height()+r.scrollTop()&&t("#ul-main").animate({scrollTop:s.closest(".ul-row").offset().top+r.scrollTop()-(r.offset().top+37)},300),t("#body").removeAttr("data-controls"),"edit"===n&&t("#body").attr("data-controls","edit"),window.dispatch(window.actions.createWidget(a.formatWidgetDataToReact(e))),s}return s=a._addWidget(l.id,l.widget,d,e.index),l.noSave||a.save(l),i.widget.factoryWidgetInstance(l.widget,{id:l.id,$el:s,controls:e.controls},function(i){"productCard"==i.type&&delete e.data,e.data&&(i.data={},t.extend(!0,i.data,e.data),i.synced=!0),e.options&&(i.options={},t.extend(!0,i.options,e.options));var s=function(e){a._smartAdjustColSizesOfRow({$row:e.$el.closest(".ul-row"),cb:o})};i.render(function(){var o=t("#"+e.originalId);"productCard"===e.widgetType?a.onProductCardAdded(s,i):(s&&s(i),"gallery2"===i.type?_.setHeight(i.$el,o.find(".ul-autocrop").innerHeight()):_.setHeight(i.$el,o)),t.each(o.closest(".ul-row").find(".ul-widget"),function(){t(this).css({overflow:""})}),i.$el.closest(".ul-row").offset().top+r.scrollTop()+i.$el.closest(".ul-row").height()>t(window).height()+r.scrollTop()&&t("#ul-main").animate({scrollTop:i.$el.closest(".ul-row").offset().top+r.scrollTop()-(r.offset().top+37)},300),t("#body").removeAttr("data-controls"),"edit"===n&&t("#body").attr("data-controls","edit")})}),"addAbsWidget"==l.act&&t(window).trigger("absWidget",{active:!1,wtype:l.widget}),a.isSingleWidget(l.widget)&&(a.singleWidgets.push(l.widget),t(window).trigger("singleWidget",{active:!1,wtype:l.widget})),s},checkSizeColCopy:function(e,o){var i=this,a=0,r=!1,n=i.widgetGlobal.minColsTable[o]||2;return e.closest(".ul-row").children(".ul-col").each(function(e,o){var r=t(o);a+=i._getMinCols(r)}),a+n>12&&(r=!0),r},copyWidget:function(e,o,a){var r=this;if("true"!=o.$el.attr("data-single-widget")&&!o.$el.parent().hasClass("ul-absolute-widgets")){var n=o.$el.hasClass("ul-widget")?o.$el.attr("data-widget")||o.type:null,s=o.$el.closest(".ul-col").index()+1,d=e;if(null!=n){var c=r.checkSizeColCopy(d,n);c&&(s=d.index()+1,d=d.parent()),t.each(o.$el.closest(".ul-row").find(".ul-widget"),function(){t(this).css({overflow:"hidden"})}),p.add({fromFile:"js/edit/constructor.js",title:"copyWidget",desc:"id: "+o.$el.attr("id")+" widgetType: "+o.type}),r.eq=s,i.history.asAtomic(function(){var e=r.dropWrapWidget({$drop:d,index:s});return l.pushAndExec({act:"copyWidget",data:{id:r.getId(),originalId:o.$el.attr("id"),noSave:!1,dropId:e.drop.attr("id"),widgetType:o.type,data:o.data,options:o.options,index:e.index,controls:o.controls,mediaParams:o.mediaParams}},a)})}}},addWidget:function(e){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e.$drop){a.next=2;break}return a.abrupt("return",!1);case 2:if(e.id=o.getId(),e.dropId=e.$drop.attr("id"),!e.$drop.hasClass("ul-absolute-widgets")&&e.$drop.attr("data-description")&&e.$drop.closest(".ul-container").attr("block-empty")&&(e.flBlockWasEmpty=!0),e.$drop.hasClass("ul-absolute-widgets")&&(e.id="ul-id-".concat(e.widgetType,"-0")),delete e.$drop,"productCard"!==e.widgetType){a.next=11;break}return a.next=10,R.create(i.params.site);case 10:t(document).trigger("draggableWidgetDisabled",["productCard",!0]);case 11:return p.add({fromFile:"js/edit/constructor.js",title:"addWidget",desc:"id: ".concat(e.id," widgetType: ").concat(e.widgetType)}),a.abrupt("return",l.pushAndExec({act:"addWidget",data:e}));case 13:case"end":return a.stop()}},a)}))()},dropWrapWidget:function(e){var t=this;return t.eq=e.index,e.$drop?i.page.deny?(i.page.deny=!1,!1):(e.$drop.hasClass("ul-col")&&e.$drop.children(".ul-widget").length>0&&t.widgetStartResize(e.$drop),e.$drop.hasClass("ul-absolute-widgets")&&0==e.index&&t.addCol(e.$drop,e.index),e.$drop.hasClass("ul-col")&&0==e.$drop.children().length&&void 0!=e.$drop.attr("data-description")&&(e.$drop=e.$drop.parent()),e.$drop.find(".ul-col").length&&0==e.$drop.find("ul-col").children().length&&void 0!=e.$drop.find(".ul-col").attr("data-description")&&(e.$drop=e.$drop.find(".ul-col")),e.$drop.hasClass("ul-col")&&0==e.$drop.children(".ul-widget").length?{drop:e.$drop,index:0}:("ul-content"==e.$drop.attr("id")&&(e.$drop.find(".ul-drop-placeholder").remove(),e.$drop=t.addBlock("block-empty",e.index),t.widgetStartResize(e.$drop.find(".ul-col")),e.$drop=e.$drop.find(".ul-col")),e.$drop.hasClass("container")||e.$drop.hasClass("container-fluid")?(e.$drop=t.addRow(e.$drop,e.index),e.index=0,t.widgetStartResize(e.$drop),e.$drop=t.addCol(e.$drop,e.index)):e.$drop.hasClass("ul-row")&&(t.widgetStartResize(e.$drop),e.moveWidget?e.$drop=t.addCol(e.$drop,e.index,!0):e.$drop=t.addCol(e.$drop,e.index),e.index=0),p.add({fromFile:"js/edit/constructor.js",title:"dropWrapWidget",desc:"index: "+e.index}),{drop:e.$drop,index:e.index})):{drop:e.$drop,index:e.index}},dragGetHelper:function(e){var o=t('<div class="ul-el-drag-helper "></div>'),i=e.width(),a='<div style="position: absolute; top: 0; left: 0; height: 100%; width: 100%;">';return e.hasClass("ul-widget")?(e.find("iframe").length&&e.hasClass("ul-w-ecwid")?o.append(t("iframe",e).contents().find("html").clone(!1)).append(a).append(e.find(".ul-elements-controls").clone(!0)).css("background-color","white"):e.find("iframe").length&&e.hasClass("ul-widget-twitterLikeBox")?(o.append(t("iframe",e).contents().find("#put-embed iframe").contents().find("html").clone(!1)).append(a).append(e.find(".ul-elements-controls").clone(!0)),o.find("html").css("max-width",Math.floor(t("iframe",e).outerWidth())).css("margin","0 auto")):e.find("iframe").length&&e.hasClass("ul-widget-socialGroups")?o.append(t("iframe",e).contents().find("#put-embed").clone(!1)).append(a).append(e.find(".ul-elements-controls").clone(!0)).css("text-align","center"):o.append(e.clone(!0).attr("id","ul-drag-fakeId")),o.find(".ul-elements-controls").addClass("ul-elements-controls-dragging")):(o.append(e.clone(!0)),o.children(".ul-container").addClass("ul-dragin-helper").height(e.outerHeight()),o.find(".ul-block-controls").addClass("ul-block-controls-dragging")),o.css({width:i,height:0===e.outerHeight()?50:e.outerHeight(),position:"fixed","z-index":9999}),o},getDragParam:function(e,o,a){if("desktop"===i.constructor.deviceMode.device){var r=this,n={handle:"widget"==a||"absWidget"==a?".ul-elements-handler":".ul-block-handler",cancel:".ui-resizable-handle, .ul-elements-controls-btns, .js-block-btn, .ul-elements-controls-nodrag, .ul-block-handler-no-drag",scroll:!1,iframeFix:!0,appendTo:e.parent(),helper:function(){return r.dragGetHelper(t(this))}};return"absWidget"==a&&(n.helper="origin"),n}},repositionAbsWidget:function(){t('.ul-position-absolute-center[data-position="right"]:not(.ul-w-move)',"#ul-main").css("right",i.getScrollWidth()),t('.ul-position-absolute-top[data-position="right"]:not(.ul-w-move)',"#ul-main").css("right",i.getScrollWidth()+18)},getPosDragElCoord:function(e,t,o,a,r){var n={},s=0;return null==i.page.$dropTarget||i.page.$dropTarget.hasClass("ul-drop-remove")?null!=i.page.$dropTarget&&i.page.$dropTarget.hasClass("ul-drop-remove")&&(t.attr("data-position",i.page.position).attr("data-party",i.page.$dropTarget.attr("data-position")),t.children(".ul-widget").length&&t.children(".ul-widget").attr("data-party","bottom"),"bottom"===a?(n.left=Math.round(e.pageX-(o.halfWidth-o.offsetX)),n.top=Math.round(e.pageY)):(s=("right"===r?-1:0)*o.halfWidth*2,n.top=Math.round(e.pageY-o[a].dragOffsetY),n.left=Math.round(e.pageX-o[a].dragOffsetX+s))):(t.attr("data-position",i.page.position).attr("data-party",i.page.$dropTarget.attr("data-position")),t.children(".ul-widget").length&&t.children(".ul-widget").attr("data-party",i.page.$dropTarget.attr("data-position")),"center"==a||"special"==a?(i.page.$dropTarget.attr("data-position")!==r&&(s=("right"===i.page.$dropTarget.attr("data-position")?1:-1)*o.halfWidth*2),n.top=Math.round(e.pageY-o[a].dragOffsetY),n.left=Math.round(e.pageX-o[a].dragOffsetX+s)):"bottom"==i.page.position?(n.left=Math.round(e.pageX-(o.halfWidth-o.offsetX)),n.top=Math.round(e.pageY)):"center"!=i.page.position&&"special"!=i.page.position||("right"==i.page.$dropTarget.attr("data-position")?n.left=Math.round(e.pageX-o.halfWidth+o.halfHeight):n.left=Math.round(e.pageX-o.halfWidth-o.halfHeight),n.top=Math.round(e.pageY))),n},dragEl:function(e,o,a,n){var s=this;if(!n)return!1;var d=null,l={},c={};"widget"!=n&&"absWidget"!=n||(l=r.get(e.attr("id"))),"absWidget"==n&&(d=e.parent().clone(!0),d.children(".ul-widget").remove(),d.removeAttr("style"),e=e.parent(),c.offsetX=e.children(".ul-widget").offset().left,c.offsetY=e.children(".ul-widget").offset().top);var u,g,h=s.getDragParam(e,o,n);e.draggable(h,{start:function(o,a){if("undefined"==typeof l)return!1;if(s.$body.find(".ul-container").css("z-index","auto"),i.menu.$el.css("z-index",1),t(".js-back-click").attr("data-type-block")&&t(".ul-disabled-overlay").trigger("click.constructor"),s.$body.attr("data-controls","drag"),s.activeDrag=!0,t("html").css("overflow-x","hidden"),i.constructor.deviceMode.isPanelConstructorEditable&&t(document).trigger("showDropArea"),"absWidget"==n)t("#body").attr("data-drag-type","fixed"),u=t(this).children(".ul-widget").data("position"),g=t(this).children(".ul-widget").data("party"),a.helper.css({width:a.helper.children(".ul-widget").outerWidth(),height:a.helper.children(".ul-widget").outerHeight()}),d=d.appendTo("#ul-main #body-fict"),s.repositionAbsWidget(),t(this).addClass("ul-w-move").addClass("js-draging").find(".ul-elements-controls").addClass("ul-elements-controls-dragging").closest(".ul-absolute-widgets").css({zIndex:400}).addClass("ul-el-abs-drag-mask"),t("#ul-left-menu").css("zIndex",1),a.helper&&!a.helper.hasClass("ul-abs-animate")&&a.helper.addClass("ul-abs-animate"),a.helper.parent().addClass("ul-el-abs-drag-mask"),l._fetchDataOptions(),c.halfWidth=a.helper.children(".ul-widget").outerWidth()/2,c.halfHeight=a.helper.children(".ul-widget").outerHeight()/2,c.center={dragOffsetX:o.pageX-c.offsetX,dragOffsetY:o.pageY-(c.offsetY+c.halfHeight)},c.special={dragOffsetX:o.pageX-c.offsetX,dragOffsetY:o.pageY-c.offsetY},c.offsetX=c.offsetX+c.halfWidth-o.pageX,c.offsetY=c.offsetY+c.halfHeight-o.pageY;else{a.helper.addClass("ul-el-drag-helper-scale");var r=t(this).offset();a.helper.css({"-webkit-transform-origin":o.pageX-r.left+"px "+(o.pageY-r.top)+"px 0","transform-origin":o.pageX-r.left+"px "+(o.pageY-r.top)+"px 0"}),t(this).closest(".ul-widget").addClass("ul-el-drag-mask")}"block"==n&&e.addClass("ul-el-drag-mask"),i.page.startDrop(n,l.type),p.add({fromFile:"js/edit/constructor.js",title:"startDragEl",desc:"element Id: "+e.attr("id")+" widgetType: "+l.type})},drag:function(e,o){"absWidget"==n?o.position=s.getPosDragElCoord(e,t(this),c,u,g):i.page.autoScrollIframeDrag(e),i.page.hover(e.clientX,e.clientY,n,l.type,l.id)},stop:function(o,r){i.page.hoverDebouncer.triggerImmediateIfNeed(),"absWidget"!=n?i.page.stopAutoscroll():t("#ul-left-menu").css("zIndex",""),s.$body.find(".ul-container").css("z-index",""),i.menu.$el.css("z-index",""),s.$body.removeAttr("data-controls"),t(this).removeClass("ul-w-move"),t(".ul-block-dragOver").removeClass("ul-block-dragOver"),t("html").css("overflow-x","auto"),s.activeDrag=!1;var c=!1,u=t(this).hasClass("ul-widget")?t(this).closest(".ul-widget"):t(this);if((i.page.$dropTarget.is("footer")||i.page.$dropTarget.is("header")||i.page.$dropTarget.hasClass("ul-el-drag-mask"))&&(c=!0,"absWidget"!=n&&(u.removeClass("ul-el-drag-mask"),t(".ul-widget-hovered").removeClass("ul-widget-hovered"))),!c)if("absWidget"==n)e.parent().removeClass("js-dragging"),t(this).parent().removeClass("ul-el-abs-drag-mask"),l.data.position=i.page.position,t(this).removeClass("js-draging").removeClass("ul-el-abs-drag-mask").removeAttr("style").attr("data-position",d.attr("data-position")).removeAttr("data-party"),i.page.$dropTarget.children(".ul-widget").length>0&&i.page.$dropTarget.attr("id")!=u.attr("id")?s.removeWidget(i.page.$dropTarget.children(".ul-widget"),function(){s.dragDrop(u.children(".ul-widget"),i.page.$dropTarget,a)},200):s.dragDrop(u.children(".ul-widget"),i.page.$dropTarget,a),d.remove(),s.repositionAbsWidget();else{u.removeClass("ul-el-drag-mask"),t(window).trigger("endDragEl",e.attr("id")),s.dragDrop(u,i.page.$dropTarget,a),u.hasClass("ul-widget")&&t(".ul-widget-hovered").removeClass("ul-widget-hovered");var g=u.closest(".ul-container");i.page.$dropTarget.hasClass("ul-drop-remove")||g.addClass("ul-container-hovered"),r.helper.remove()}t(document).trigger("hideDropArea"),i.page.stopDrop(),t(this)&&t(this).hasClass("ui-draggable")&&e.draggable("destroy"),e.show(),"absWidget"==n&&(t("#body").removeAttr("data-drag-type"),t(".ul-abs-animate").removeClass("ul-abs-animate")),p.add({fromFile:"js/edit/constructor.js",title:"stopDragEl",desc:"$target Id: "+u.attr("id")+" widgetType: "+l.type})}}).trigger("mousedown.draggable",o)},dragDrop:function(e,o,a){var r=this;if(e.hasClass("ul-widget"))if(o.hasClass("ul-drop-remove"))r.removeWidget(e);else if(e.data("dropPositionFixed"))r.moveWidget(e,o,0,function(){});else if(o.hasClass("ul-col")&&!o.children(".ul-widget").length)r.moveWidget(e,o,0);else{l.beginAtomic();var n=r.dropIndexWidget(o);o=o.parent();var s=r.dropWrapWidget({$drop:o,index:n.index,moveWidget:a});if(!s)return l.endAtomic(),!1;r.moveWidget(e,s.drop,s.index,function(){l.endAtomic()})}else if(e.hasClass("ul-container"))if(o.hasClass("ul-drop-remove")){if(!i.constructor.deviceMode.isPanelConstructorEditable)return;if(e.hasClass("ul-symbol"))return B.symbolBlock.removeRef(e,r);r.removeBlock(e)}else{var d=o.index(),c=null;t.each(o.parent().children(".ul-container"),function(e,i){t(i).attr("id")===o.attr("id")&&(c=e)}),null==c?c=d:d=c,o.hasClass("ul-drop-container-bottom")&&(d+=1),r.moveEl(e,o,d)}p.add({fromFile:"js/edit/constructor.js",title:"dragDrop",desc:"is elemet widget: "+e.hasClass("ul-widget")})},destroyResizable:function(e){var o=e.closest(".ul-row").length?e.closest(".ul-row").children(".ul-col"):t(".ul-col",e);o.length&&t.each(o,function(e,o){t(o).hasClass("ui-resizable")&&t(o).resizableBootstrap("destroy")})},dropIndexWidget:function(e){var o;return e.hasClass("ul-widget")&&t.each(e.closest(".ul-row").children(".ul-col"),function(e,o){t(o).hasClass("ui-resizable")&&t(o).resizableBootstrap("destroy")}),o=e.index(),e.hasClass("ul-drop-right")&&(o+=1),e.hasClass("ul-drop-bottom")&&(o+=1,e.hasClass("ul-widget")&&e.parent(".ul-col").children(".ul-widget").length<o&&e.parent(".ul-col").children(".ul-widget").length==e.index()&&(o-=1)),{index:o}},getGrid:function(){for(var e='<div class ="ul-grid-step col-xs-12 col-sm-12 col-md-12 col-lg-12">',t=0;12>t;t++)e+='<div class="ul-resize-position col-xs-1 col-sm-1 col-md-1"></div>';return e+="</div>"},getId:function(){return"ul-id-"+this.lastId+"-"+this.lastSessionId++},__moveWidget:function(e,o,a,n,s){var d=this,l=e.closest(".ul-col");n||(n=function(){});var c=this._moveWidget(e,o,a),u=function(){d._smartAdjustColSizesOfRow({$row:c.closest(".ul-row"),cb:n})},p=!1;void 0!=o.attr("data-description")&&(o.removeAttr("data-description"),o.closest(".ul-container").children(".ul-block-controls").find(".ul-block-title").text(g("constructor.block")),p=!0);var h={act:"moveWidget",to:o.attr("id"),id:e.attr("id"),index:a};if(e.data("dropPositionFixed")){var f=r.get(e.attr("id"));f?(f.$el.length||(f.$el=t("#"+f.id)),h.data=f.data,h.__t=e.data("widget"),h.data.position=f.data.position||i.page.position||"bottom",h.data.party=o.data("position"),d.save(h),f.render(function(){n()})):console.error("__moveWidget",'widget "'+e.attr("id")+'" not found')}else{"mainmenu"===e.data("widget")&&t(window).trigger("mainmenu.needChangeSelector",e),window.dispatch(window.actions.linkWidgetBlock(h.id,o.closest(".ul-container").attr("id"))),window.dispatch(window.actions.linkWidgetCol(h.id,o.closest(".ul-col").attr("id"))),window.dispatch(window.actions.linkColRow(o.closest(".ul-col").attr("id"),c.closest(".ul-row").attr("id"))),this.save(h);var m=function(){setTimeout(function(){d._smartAdjustColSizesOfRow({$row:e.closest(".ul-row"),cb:n})},500)};if(l.children(".ul-widget").length)m();else if(s||void 0!=l.closest(".ul-container").attr("block-empty")&&0!=l.closest(".ul-container").attr("block-empty")&&"false"!=l.closest(".ul-container").attr("block-empty"))if(l.closest(".ul-container").find(".ul-col").length>1){l.closest(".ul-row").attr("id")!==o.closest(".ul-row").attr("id")&&(p?d.widgetStartResize(o.closest(".ul-row").children(".ul-col")):d.widgetStartResize(l));var v=l.closest(".ul-row"),w=v.children(".ul-col").size()-1;0==w?d.removeCol(l,m):d.removeCol(l,function(){p||n()})}else 0==l.children(".ul-widget").length&&(l.attr("data-description",g("constructor.Drag elements from the left panel")),l.closest(".ul-container").find(".ul-drag-container-desc").text(g("constructor.empty block handler name"))),u();else d.widgetStartResize(l),d.removeCol(l,n)}},moveWidget:function(e,t,o,i){var a={};a.widgetId=e.attr("id"),a.targetId=t.attr("id"),i||(i=function(){}),a.colId=e.closest(".ul-col").attr("id"),t.hasClass("ul-absolute-widgets")||(void 0!=t.attr("data-description")||0!=t.closest(".ul-container").attr("block-empty"))&&e.closest(".ul-container").find(".ul-col").length<=2||(a.flBlockWasEmpty=!0),a.oldIndex=e.closest(".ul-col").children(".ul-widget").get().indexOf(e[0]),a.index=o,p.add({fromFile:"js/edit/constructor.js",title:"moveWidget",desc:"data.widgetId: "+a.widgetId+"data.targetId: "+a.targetId}),l.pushAndExec({act:"moveWidget",data:a},i)},__moveEl:function(e,o,i,a){var r=this,n=null!=a||void 0!=a?a.attr("id"):null,s={act:"moveEl",index:i,to:o.parent().attr("id"),id:e.attr("id"),prevEl:n},d=this._dropPosition(e,i,o.parent()),l=d.parent().children(".ul-container");t.each(l,function(e,o){t(o).attr("id")===d.attr("id")&&(s.index=e)}),t("#ul-main").animate({scrollTop:d.offset().top+t("#ul-main").scrollTop()-(t("#ul-main").offset().top+37)},200),r.save(s),e.hasClass("ul-container")&&r.posContainerHandler()},moveEl:function(e,t,o){var i=e.attr("id"),a=t.attr("id"),r=o<e.index()?e.index()+1:e.index(),n=a;p.add({fromFile:"js/edit/constructor.js",title:"moveEl",desc:"elId: "+i+"dropId: "+a}),l.pushAndExec({act:"__moveEl",data:{elId:i,dropId:a,index:o,curIndex:r,curDropId:n}})},removeCol:function(e,o,i,a){var r=this;o||(o=function(){});var n,s=e.attr("id"),d=e.index(),c=e.closest(".ul-row").attr("id");return e.attr("id").match(/special/)?t("#"+s):(n=r._dumpColSizesOfRow(t("#"+c)),p.add({fromFile:"js/edit/constructor.js",title:"removeCol",desc:"id: "+s}),l.pushAndExec({act:"removeCol",data:{id:s,index:d,rowId:c,colSizes:n,notSmartAdj:a}},function(){return r.__removeCol(t("#"+s),o,i,a)}))},__removeCol:function(e,o,i,a){var r=this,n=e.height();o||(o=function(){}),this.save({act:"removeCol",id:e.attr("id")});var s=e.closest(".ul-row"),d=s.children(".ul-col").size()-1;r._removeCol(e);var l=function(){r._smartAdjustColSizesOfRow({$row:s,autocrop:!a,cb:o})};t.each(s.children(".ul-col"),function(e,o){t(o).hasClass("ui-resizable")&&!t(o).hasClass("ul-widget")&&t(o).resizableBootstrap("destroy")}),0==d?(s.height(n),r.removeRow(s,o,i)):l()},_smartAdjustColSizesOfRow:function(o){var i=this;o=t.extend({$row:null,autocrop:!0,cb:function(){}},o);var a=i._dumpColSizesOfRow(o.$row),r=[];if(a.length){o.$row.children(".ul-col").each(function(e,o){r.push(i._getMinCols(t(o)))});for(var n=12,s=a.map(function(e,t){var o=r[t];return n-=e,{i:t,s:e-o}}),d=!1;n>0;){d=!0;var l=e.min(s,function(e){return e.s});n--,l.s++,a[l.i]++}for(;0>n;){d=!0;var c=e.max(s,function(e){return e.s});if(c.s<=0)return void console.info("_smartAdjustColSizesOfRow problem!");n++,c.s--,a[c.i]--}for(var u;u=e.find(s,function(e){return e.s<0});){d=!0;var g=e.max(s,function(e){return e.s});if(g.s<=0)return void console.info("_smartAdjustColSizesOfRow problem!");g.s--,a[g.i]--,u.s++,a[u.i]++}var h=800;d&&(i._restoreColSizesOfRow(o.$row,a),h=700),setTimeout(function(){i.widgetCompleteResize(o.$row,o.cb,o.autocrop)},h),p.add({fromFile:"js/edit/constructor.js",title:"_smartAdjustColSizesOfRow",desc:"timer delay: "+h})}},_dumpColSizesOfRow:function(e){var o=this,i=[];return o.widgetStartResize(e),e.children(".ul-col").each(function(e,a){var r=t(a);i.push(1*o.REG_CLASS_MD.exec(r.attr("class"))[1])}),i},_restoreColSizesOfRow:function(e,o){var i=this,a=e.children(".ul-col");i.widgetStartResize(e),a.each(function(e){e+1<a.length&&i.__setColSize(t(a.get(e)),t(a.get(e+1)),o[e],o[e+1])})},__removeRow:function(e,t,o){var i=this;if(t||(t=function(){}),!e||!e.length)return void n.notify("error $el not exist","error");if(!e.closest(".ul-row"))return void n.notify("error ul-container not exist","error");i.save({act:"removeRow",id:e.attr("id")});var a=e.closest(".ul-container"),r=e.closest(".container"),s=e.closest(".container-fluid");e.animate({height:0},o?0:200,"linear",function(){i._removeRow(e),!r.children(".ul-row").length&&r.length||!s.children(".ul-row").length&&s.length?i.removeBlockWithoutWidgets(!1,a,t):t()})},removeRow:function(e,o,i){var a=this;o||(o=function(){});var r=e.attr("id"),n=e.index(),s=e.closest(".ul-container").attr("id");p.add({fromFile:"js/edit/constructor.js",title:"removeRow",desc:"id: "+r}),l.pushAndExec({act:"removeRow",data:{id:r,index:n,ulContainerId:s}},function(){return a.__removeRow(t("#"+r),o,i)}),a.activeAutocrop=!1},__removeBlockWithoutWidgets:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},o=this;if(t||(t=function(){}),!e||!e.length)return n.notify("error $el not exist","error");var i=e.closest(".ul-container");if(!i.length)return n.notify("error ul-container not exist","error");var a={act:"removeBlock",id:e.attr("id")},r=e.parent();o._removeBlock(e),o.save(a),r.children(".ul-container").length||r.html('<div class="container ul-drop-placeholder js-block-container"><div class="ul-empty-ingorm"><div class="ul-empty-drag-help"></div> <p>'+g("constructor.Drag elements or block from the left panel")+"</p></div></div>"),o.posContainerHandler(),t()},removeBlockWithoutWidgets:function(e,o,i){var a=this;i||(i=function(){});var r=o.attr("id"),n=o.index();o.hide();var s=o.attr("id");setTimeout(function(){a.getBlockSettings(s,function(o){o.id=s,a.blockSettings[s]||(a.blockSettings[s]=c.cloneDeep(o));var d=c.cloneDeep(a.blockSettings[r]),u="removeBlockWithoutWidgets";e&&(u="removeBlockEmptyWithoutWidgets"),p.add({fromFile:"js/edit/constructor.js",title:"removeBlockWithoutWidgets",desc:"blockSetting[id]: "+o.id}),l.pushAndExec({act:u,data:{oldBlockSettings:d,index:n,id:r}},function(){e?i():a.__removeBlockWithoutWidgets(t("#"+r),i)})})},200)},__removeBlockWithWidgets:function(e,o,i){var a=o.find(".ul-widget").map(function(){return t(this).attr("id")}).get();return a.length?(window.dispatch(window.actions.unmountBlock(a,arguments)),void this.posContainerHandler()):this.__realRemoveBlockWithWidgets([],e,o,i)},__realRemoveBlockWithWidgets:function(e,o,i,a){var r=this,n=[];i.find(".ul-widget").each(function(){n.push(t(this))});var s=0;i.css({"min-height":0,"max-height":i.outerHeight(),overflow:"hidden"}),i.css("overflow","hidden"),i.animate({height:s},200,"linear",function(){n.length?u.map(n,function(t,o){var a=t.attr("id");n.indexOf(t)===n.length-1?r.lockBlock(i,!1,function(){r.removeWidget(t,o,!0,!1,!0,e[a])}):r.removeWidget(t,o,!0,!1,!0,e[a])},a):r.lockBlock(i,!1,function(){r.removeBlockWithoutWidgets(o,i,a)})})},removeBlock:function(e,t){var o=this;t||(t=function(){});var a=!e.find(".ul-widget").length;i.history.beginAtomic(),o.lockBlock(e,!0,function(){o.__removeBlockWithWidgets(a,e,function(){p.add({fromFile:"js/edit/constructor.js",title:"removeBlock"}),i.history.endAtomic(),t()})})},__removeWidget:function(e,t,o,i,a){var r=e.data("widget")||"";if(r)this.__realRemoveWidget(e,t,o,i,a);else{if(!e.attr("id"))return;window.dispatch(window.actions.unmountWidget(e.attr("id"),arguments))}},__realRemoveWidget:function(o,a,n,s,d){var l=this,c=o.data("widget")||"",u=o.attr("id");a||(a=function(){});var p=o.closest(".ul-col");o.css({"max-height":o.outerHeight(),overflow:"hidden"});var h=a;a=function(){"productCard"===c?(i.params.shop.productCardsQuantity--,l.onProductCardRemoved(h)):h()};var f=o.closest(".ul-absolute-widgets").length?"removeAbsWidget":"removeWidget";1===p.children(".ul-widget").length&&!s&&!d&&p.parent().children(".ul-col").length>1&&l.widgetStartResize(p),l.save({act:f,id:u}),p.children(".ul-widget").length>1?(p.css({"min-height":p.height(),"max-height":p.height()}),o.animate({width:0},n?0:200,"linear",function(){t(window).trigger("widgetRemoved",u),l._removeWidget(o),p.css("max-height",""),p.css("min-height",""),0==p.children(".ul-widget").length?s?p.closest(".ul-container").find(".ul-col").length>1?l.removeCol(p,a,n,d):(0==p.children(".ul-widget").length&&"blog"!==i.params.pageType&&(p.attr("data-description",g("constructor.Drag elements from the left panel")),p.closest(".ul-container").find(".ul-drag-container-desc").text(g("constructor.empty block handler name"))),a()):l.removeCol(p,a,n,d):a()})):(p.css({"min-height":p.height(),"max-height":p.height(),"min-width":0,overflow:"hidden"}),p.animate({width:0},n?0:200,"linear",function(){t(window).trigger("widgetRemoved",u),l._removeWidget(o),p.hasClass("ul-absolute-widgets")?(p.css({"min-height":"","max-height":"",width:"",height:"",overflow:""}),a()):s?p.closest(".ul-container").find(".ul-col").length>1?l.removeCol(p,a,n,d):(p.css({"min-height":"","max-height":"",width:"",
overflow:"auto"}),0==p.children(".ul-widget").length&&"blog"!==i.params.pageType&&(p.attr("data-description",g("constructor.Drag elements from the left panel")),p.closest(".ul-container").find(".ul-drag-container-desc").text(g("constructor.empty block handler name"))),a()):l.removeCol(p,a,n,d)})),r.remove(u),"removeAbsWidget"==f&&(l.activeAutocrop=!1,t(window).trigger("absWidget",{active:!0,wtype:c})),l.isSingleWidget(c)&&(l.singleWidgets=e.without(l.singleWidgets,c),t(window).trigger("singleWidget",{active:!0,wtype:c}))},isSingleWidget:function(e){return i.params.singleWidgetsList.some(function(t){return t===e})},isSingleWidgetPage:function(e){var t=this;if(t.isSingleWidget(e))return t.singleWidgets.some(function(t){return e===t})},removeWidget:function(e,t,o,a,r,n){t||(t=function(){});var s={};s.id=e.attr("id"),s.colId=e.closest(".ul-col").attr("id"),s.widgetType=e.data("widget")||n.type||e.data("type"),s.index=e.closest(".ul-col").children(".ul-widget").get().indexOf(e[0]);var d=i.widget.get(s.id)||n;return s.data=c.cloneDeep(d.data),s.options=c.cloneDeep(d.options),s.flFast=o,s.flNotRemoveCol=a,s.notSmartAdj=r,s.anchor=d.anchor||e.data("anchor"),p.add({fromFile:"js/edit/constructor.js",title:"removeWidget",desc:"id: "+s.id+" widgetType: "+s.widgetType}),l.pushAndExec({act:"removeWidget",server:!0,data:s},t)},save:function(e,t){var o="",a=l.actions[e.act];(a&&a.a.isSymbol(e)||e.symbolAction)&&(o=i.params.symbolPageId);var r=o||i.params.page,n=o?"":this.lastId,s=!!o;p.add({fromFile:"js/edit/constructor.js",title:"save",desc:"save: /sites/url/"+i.params.site+"/pages/id/"+r+"/save"}),i.enqueueAjax({url:"/sites/url/"+i.params.site+"/pages/id/"+r+"/save",data:e,parallel:!1,lastId:n,version:i.params.version,symbol:s,cb:t})},setBlockClasses:function(e,o){this.save({act:"setBlockClasses",el:e,classes:o}),t("#"+e).attr("class",this.blockClasses.join(" ")+" "+o.join(" "))},__setColSize:function(e,o,a,r){this._setColSize(e,o,a,r,i.constructor.deviceMode.device);var n={act:"setColSize",el:e.attr("id"),elColSize:a,nextEls:o.map(function(){return t(this).attr("id")}).toArray().join(","),nextElsColSize:r,device:i.constructor.deviceMode.device};this.save(n)},setColSize:function(e,t,o,i){var a=this,r=e.attr("id"),n=t.attr("id"),s={desktop:{target:parseInt(a.REG_CLASS_MD.exec(e.attr("class"))[1]),next:parseInt(a.REG_CLASS_MD.exec(t.attr("class"))[1])},tablet:{target:parseInt(a.REG_CLASS_SM.exec(e.attr("class"))[1]),next:parseInt(a.REG_CLASS_SM.exec(t.attr("class"))[1])},phone:{target:parseInt(a.REG_CLASS_XS.exec(e.attr("class"))[1]),next:parseInt(a.REG_CLASS_XS.exec(t.attr("class"))[1])}},d=parseInt(a.REG_CLASS_MD.exec(e.attr("class"))[1]),c=parseInt(a.REG_CLASS_MD.exec(t.attr("class"))[1]);return p.add({fromFile:"js/edit/constructor.js",title:"setColSize",desc:"id: "+r+", nextId: "+n}),l.pushAndExec({act:"setColSize",data:{id:r,nextId:n,undoSize:d,undoSizeNext:c,elColSize:o,nextElsColSize:i,prevSize:s}})},_getMinCols:function(e){var o=0;return e.children(".ul-widget").each(function(e,i){var a=t(i);if(!a.hasClass("ul-el-drag-mask")){var n=r.minColsTable[a.data("widget")||a.attr("type")];n>o&&(o=n)}}),o},setResizeCol:function(e){var o=this;return"desktop"!==i.constructor.deviceMode.device?void(e.hasClass("ui-resizable")&&this.destroyResizable(e)):void window.requestAnimationFrame(function(){var i=[];e.not(":last").each(function(){var e,o=this,a=t(this),r=a.next(".ul-col"),n=a.closest(".ul-row");n.length&&(e=n.outerWidth());var s,d=o.getBoundingClientRect().width+l;r.length&&(s=r[0].getBoundingClientRect().width+l);var l=parseInt(a.css("margin-left"))+parseInt(a.css("margin-right"));i.push({col:this,$col:a,$next:r,$row:n,widthParentElement:e,widthThisElement:d,widthNextEl:s,marginEl:l})}),i.forEach(function(e){return o.addResizableToCol(e.col,e.$col,e.$next,e.$row,e.widthParentElement,e.widthThisElement,e.widthNextEl,e.marginEl)})})},addResizableToCol:function(e,o,i,a,r,n,s,d){var l,c=this,u=null;setTimeout(function(){o.resizableBootstrap({handles:"e",create:function(){u=t('<div class="ul-resizable-view"></div>'),u.css("background-color","rgba(203,210,217,1)"),u.appendTo(o.children(".ui-resizable-e"))},start:function(e,r){c.widgetStartResize(o,!0),c.activeResize=!0,t(".js-back-click").attr("data-type-block")&&t(".ul-disabled-overlay").trigger("click.constructor"),c.$body.attr("data-controls","resize"),r.element.find(".ul-resizable-view").addClass("ul-resizeble-view-hover"),o.css({overflow:"hidden"}),i.css({overflow:"hidden"}),a.find(".ul-grid-step").remove(),a.prepend(c.getGrid()),void 0==i&&o.resizableBootstrap("widget").trigger("mouseup"),n=this.getBoundingClientRect().width,s=i[0].getBoundingClientRect().width,l=n+s,p.add({fromFile:"js/edit/constructor.js",title:"start resize col",desc:"row id: "+a.attr("id")})},resize:function(){var e=this.getBoundingClientRect().width,a=(i[0].getBoundingClientRect().width+d)/r*100,n=l-e;i.outerWidth(n-d);var s=Math.round(e/r*100);i.find(".owl-item.active").length&&t.each(i.find(".owl-item.active"),function(e,o){t(o).width(n)}),o.find(".owl-item.active").length&&t.each(o.find(".owl-item.active"),function(e,i){t(i).width(o.width())}),[[o,s],[i,a]].forEach(function(e){var t=e[0],i=e[1],a=c.STEP_GRID*c._getMinCols(t)-1;a>i&&o.resizableBootstrap("widget").trigger("mouseup")})},stop:function(l,u){o.css({overflow:""}),i.css({overflow:""}),c.$body.removeAttr("data-controls"),t(".ul-resizeble-view-hover").removeClass("ul-resizeble-view-hover"),n=this.getBoundingClientRect().width+d,s=i[0].getBoundingClientRect().width+d,u.element.find(".ul-resizable-view-hover").removeClass("ul-resizeble-view-hover"),c.activeResize=!1,a.find(".ul-grid-step").remove(),t(document).off("hoverHandler");var g=Math.round((e.getBoundingClientRect().width+d)/r*100),h=Math.round((n+s)/r*100),f=h-g,m=Math.round(g/c.STEP_GRID),v=Math.round(f/c.STEP_GRID);0==m?(m+=2,v-=2):0==v&&(m-=2,v+=2),p.add({fromFile:"js/edit/constructor.js",title:"stop resize col"}),c.setColSize(o,i,m,v)}})},0)},changeColSize:function(){var o=this,i=t(),a=null;return o.startColChange&&o.stopColChange&&t.each(o.startColChange,function(r,n){if(n.rowId===o.stopColChange.rowId){a=r;var s=o.eq,d=[];n.eq&&(s=n.eq+1),n.colLength<=o.stopColChange.colLength&&(n.col.size.splice(s,0,0),n.col.index.push(n.col.index.length)),n.colLength>=o.stopColChange.colLength&&(n.col.size.splice(s,1),n.col.index.pop(n.col.index.length)),t.each(n.col.size,function(e,t){t!=o.stopColChange.col.size[e]&&(d.push(e),i=i.add(n.$row.children(".ul-col").eq(e)))}),i.length||t.each(n.col.index,function(e,t){d.push(t),i=i.add(n.$row.children(".ul-col").eq(t))});var l=e.sortBy(e.uniq(d),function(e){return Math.min(e)});(l.legth<2||l.reduce(function(e,t,o,i){var a=Math.abs((i[o-1]||0)-t);return Math.max(a,e)},Math.abs(l[0]-l[1]))>2)&&l.forEach(function(e){[e-1,e+1].forEach(function(e){i=i.add(n.$row.children(".ul-col").eq(e))})})}else n.$row.children(".ul-col").length&&(i=i.add(n.$row.children(".ul-col")))}),null!==a&&o.startColChange.length>1?o.startColChange.splice(a,1):null!==a&&delete o.startColChange,delete o.stopColChange,i},getStartChangeCol:function(e){var o=this;if(o.startColChange&&o.startColChange.length||(o.startColChange=[]),o.startColChange.length){var i=!0;t.each(o.startColChange,function(t,o){o.rowId!==e.closest(".ul-row")&&(i=!1)}),i||(o.startColChange.push({rowId:e.closest(".ul-row").attr("id"),$row:e.closest(".ul-row"),colLength:e.closest(".ul-row").children(".ul-col").length,col:{index:[],size:[]}}),e.closest(".ul-row").children(".ul-col").each(function(e,i){var a=t(i);o.startColChange[o.startColChange.length-1].col.index.push(a.index());var r=2;o.REG_CLASS_MD.exec(a.attr("class"))?r=o.REG_CLASS_MD.exec(parseInt(a.attr("class"))[1]):o.REG_CLASS_XS.exec(a.attr("class"))?r=o.REG_CLASS_XS.exec(parseInt(a.attr("class"))[1]):o.REG_CLASS_SM.exec(a.attr("class"))&&(r=o.REG_CLASS_SM.exec(parseInt(a.attr("class"))[1])),o.startColChange[o.startColChange.length-1].col.size.push(r)}))}else o.startColChange.push({rowId:e.closest(".ul-row").attr("id"),$row:e.closest(".ul-row"),colLength:e.closest(".ul-row").children(".ul-col").length,col:{index:[],size:[]}}),e.closest(".ul-row").children(".ul-col").each(function(e,i){var a=t(i);o.startColChange[0].col.index.push(a.index()),o.REG_CLASS_MD.exec(a.attr("class"))?o.startColChange[0].col.size.push(parseInt(o.REG_CLASS_MD.exec(a.attr("class"))[1])):o.REG_CLASS_XS.exec(a.attr("class"))?o.startColChange[0].col.size.push(parseInt(o.REG_CLASS_XS.exec(a.attr("class"))[1])):o.REG_CLASS_SM.exec(a.attr("class"))&&o.startColChange[0].col.size.push(parseInt(o.REG_CLASS_SM.exec(a.attr("class"))[1]))})},getStopChangeCol:function(e){var o=this;o.stopColChange={rowId:e.attr("id"),$row:e,colLength:e.children(".ul-col").length,col:{index:[],size:[]}},e.children(".ul-col").each(function(e,i){var a=t(i);o.stopColChange.col.index.push(a.index()),o.stopColChange.col.size.push(1*o.REG_CLASS_MD.exec(a.attr("class"))[1])})},widgetStartResize:function(e,o){var i=this,a=t();o?(a=a.add(e).add(e.next()),i.getStartChangeCol(e)):e.hasClass("container")||e.hasClass("container-fluid")?a=e.find(".ul-col"):(i.getStartChangeCol(e),t.each(i.startColChange,function(o,i){i.rowId===e.closest(".ul-row").attr("id")&&t.each(i.col.index,function(e,t){a=a.add(i.$row.children(".ul-col").eq(t))})})),i.activeAutocrop=!0},complete_getNoChangedCol:function(e,o){if(!e||!o)return null;var i=e.closest(".ul-row"),a=o.closest(".ul-row");return i.attr("id")!==a.attr("id")||e.length===o.length?null:(t.each(e,function(e,i){t.each(o,function(e,a){t(i).attr("id")===t(a).attr("id")&&o.splice(e,1)})}),o)},widgetCompleteResize:function(e,o,i){var a=this,r=t(),n=null;o||(o=function(){}),p.add({fromFile:"js/edit/constructor.js",title:"widgetCompleteResize"}),e.hasClass("container")||e.hasClass("container-fluid")?r=e.find(".ul-col"):(a.getStopChangeCol(e),a.startColChange&&(n=a.startColChange.$sendCol,r=a.changeColSize())),r.length?(delete a.startColChange,n&&(n=a.complete_getNoChangedCol(r,n)),p.add({fromFile:"js/edit/constructor.js",title:"widgetCompleteResize find changed cols",desc:r.length+" cols was changed"}),_.stop(r,i),t(window).trigger("changeColEnd",r),t(window).trigger("colResized",r),o(),r=null,n=null):o(),a.activeAutocrop=!1},formatWidgetDataToReact:function(e){return{controls:"mer",id:e.id,forceSave:e.forceSave||!1,type:e.widgetType,anchor:e.anchor||null,data:e.data||{},opts:e.opts||e.options||{},hidden:!1,mediaParams:e.mediaParams||null}},draggableDestroy:function(){var e=t(".ui-draggable");e.length&&e.draggable("destroy")},destroy:function(){var e=this;e._destroyEvents(),C.destroy()}};return t.extend(P,v,w,b,y,I),Object.keys(P).forEach(function(e){if(e.match(/HistoryAction$/)){var t=P[e];l.regAction(P,t),delete P[e]}}),P});
//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map

//# sourceMappingURL=constructor.js.map
