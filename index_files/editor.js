"use strict";define("editor",["U","_","text!/widgets/wysiwyg/editorControls.html","imagelib","imagecrop","panelDialog","link","popup","i18n","classapplier","css!/css/require/widgets/editor.css","imageLibOpener","videoBox","jquery","jquery-ui-resizable-bootstrap"],function(e,t,i,o,n,s,l,r,a,d,c,g,h){var f={opt:null,vars:{},init:function(e){var o=this;if(e.$el.closest(".ul-widget").length&&e.$el.closest(".ul-widget").hasClass("js-w-remove"))return!1;if(o.vars.enabled){if(o.opt.$el.get(0)==e.$el.get(0))return;o.deinit()}o.opt=$.extend({__:a,$el:null,parent:"#ul-main",placeholder:"",defaultTag:"p",inlineButtons:["bold","italic","link"],imageButtons:["edit","separator","align","separator","link","separator","remove"],videoButtons:["align","separator","remove"],additionalButtons:{title:"title",tags:{h2:"header2",h3:"header3",h4:"header4",p:"paragraph",h5:"important",h6:"node"},settings:[["bold","italic"],["align"],["lists"],["link","image"]]},image:!0,autosave:1e4,imageMinWidth:16,imageMinHeight:16,imageMargin:10,additionalPanel:!0,inlinePanel:!0,inlinePanelFixed:!1,inlineAlwaysShow:!0,useEnter:!0,clearFormat:!0,useText:!1,imgCrop:!0,alignFull:!1,theme:"g-theme-site-1",blockTheme:"g-theme-block-1",colors:["g-color-text-1","g-color-text-2","g-color-text-3"],save:function(){},select:function(){},beforeAction:function(){},beforeClose:function(){},beforeOpen:function(){},afterOpen:function(){},changeHtml:function(){},removeImg:function(){},onlyImages:!1},e),o.opt.beforeOpen(o.vars),o.vars.$parent=$(""+o.opt.parent),o.vars.oldHtml=o.opt.$el.html(),o.opt.$el.attr("contenteditable",!0).attr("spellcheck",!1).addClass("ul-editableWithEditor"),o.vars.enabled=!0,document.execCommand("defaultParagraphSeparator",!1,"p"),document.execCommand("enableObjectResizing",!1,!1),document.execCommand("styleWithCSS",!1,!0),o.opt.placeholder.length||(o.opt.placeholder=o.opt.$el.attr("placeholder")),o.vars.$renderedControls=$(t.template(i,o.opt)),o._controls("add"),o._addEventListener(),o.opt.afterOpen(o.vars),o._isEmpty(),o.opt.colors&&o.opt.colors.length&&(o.vars.colorClasses={},o.opt.colors.forEach(function(e){o.vars.colorClasses[e]=d.createClassApplier(e)})),o._readMore.check()},deinit:function(){var e=this;e.opt&&e.opt.$el.length&&(e.opt.beforeClose(e.vars),e.save(),e._controls("remove"),$(window).off(".wysiwygEvents"),e.opt.$el.off(".wysiwygEvents").removeAttr("contenteditable").removeClass("ul-editableWithEditor").blur(),clearInterval(e.vars.timer),e.insertPlaceholder({$el:e.opt.$el,placeholder:e.opt.placeholder,tag:e.opt.defaultTag}),e._selection.clear(),e.vars={},e.vars.enabled=!1,e.opt=null)},save:function(){var e=this;if(e.opt.$el.length){e.opt.$el.find(".js-editor-empty-placeholder").length&&(e.opt.$el.find(".js-editor-empty-placeholder").remove(),e.opt.$el.html("<"+e.opt.defaultTag+">&nbsp;</"+e.opt.defaultTag+">"));var t=e.opt.$el.html();if(t.length>12e4)return void console.warn("Слишком много текста");t!=e.vars.oldHtml&&(e.opt.useText&&(t=e.opt.$el.text()),e.opt.save(t),e.vars.oldHtml=t)}},isOpen:function(){return this.vars.enabled||!1},_addEventListener:function(){return this.opt.onlyImages?void this._addImageOnlyEventListeners():void this._addAllEventListeners()},_addAllEventListeners:function(){var e=this;$(window).on("resize.wysiwygEvents",function(){e.opt.inlinePanel&&e._inlineControls.checkShow(),e.opt.image&&null!=e._imageControls.$img&&e._imageControls.position()}),e.opt.$el.on("mouseup.wysiwygEvents",function(t){var i=$(t.target);if(e._lightenControls(),!e._imageControls.resize&&!e._videoControls.resize)if("IMG"===i.get(0).tagName){if(!e.opt.image)return;null==e._imageControls.$img?e._imageControls.show(i):e._imageControls.$img.get(0)!=i.get(0)&&(e._imageControls.hide(),setTimeout(function(){e._imageControls.show(i)},100)),null!=e._videoControls.$video&&e._videoControls.hide(),e.opt.inlinePanel&&e._inlineControls.hide(),e._readMore.deactivate()}else i.hasClass("video-inline")?(null==e._videoControls.$video?e._videoControls.show(i):e._videoControls.$video.get(0)!=i.get(0)&&(e._videoControls.hide(),setTimeout(function(){e._videoControls.show(i)},100)),null!=e._imageControls.$img&&e._imageControls.hide(),e.opt.inlinePanel&&e._inlineControls.hide(),e._readMore.deactivate()):"HR"===i.get(0).tagName?(e._readMore.activate(i),e._selection.clear()):(e._selection.save(),e.opt.inlinePanel&&e._inlineControls.checkShow(),e.opt.image&&e._imageControls.hide(),e._videoControls.hide(),e._readMore.deactivate())}).on("mousedown.wysiwygEvents",function(t){2!==t.button&&(e._selection.clear(),e._inlineControls.hideIfNeeded())}).on("keyup.wysiwygEvents",function(t){e._isEmpty(),e._selection.save(),null==e._imageControls.$img&&e.opt.inlinePanel&&e._inlineControls.checkShow(),f._lightenControls(),13==t.keyCode&&f.opt.$el.find(".video-inline").each(function(e,t){$(t).find("iframe").length||$(t).removeClass("video-inline").removeAttr("data-signature").removeAttr("style")}),8==t.keyCode&&f.opt.$el.find(".video-inline").each(function(e,t){var i=!1;$(t).children().each(function(e,o){"IFRAME"!=$(o).prop("tagName")&&($(t).before($(o).wrap("<p />")),i=!0)}),i&&$(t).remove()}),f.opt.$el.find(".video-inline").each(function(e,t){var i=$(t).contents();i.length>1&&i.each(function(e,i){if("IFRAME"!=i.nodeName){$(i).insertAfter(t).wrap("<p />");var o=document.createRange(),n=window.getSelection();o.setStart($(i)[0],$(i).length),o.collapse(!0),n.removeAllRanges(),n.addRange(o)}})})}).on("keydown.wysiwygEvents",function(t){return e._isEmpty(),e._readMore.deactivate(),e._readMore.check(),46==t.keyCode&&e.vars.empty&&t.preventDefault(),e.opt.useEnter||13!=t.keyCode?void e._changeInner():!1}).on("dragstart.wysiwygEvents",e.opt.$el,function(){return e._selection.clear(),!1}).on("drop.wysiwygEvents",function(){return!1}).on("paste.wysiwygEvents",function(i){i.preventDefault(),e._inlineControls.hideIfNeeded();var o="";return null!=i.originalEvent.clipboardData&&(o=i.originalEvent.clipboardData.getData("text/plain")),o.length>0&&(o=t.escape(o),e._applySelection.text("inserthtml",o)),!1}).on("cut.wysiwygEvents",function(t){e._inlineControls.hideIfNeeded()}),e.opt.autosave&&(e.vars.timer=setInterval(function(){e.save()},e.opt.autosave))},_addImageOnlyEventListeners:function(){var e=this;this.opt.$el.on("mouseup.wysiwygEvents",function(t){t.preventDefault(),t.stopPropagation();var i=$(t.target);!e._imageControls.resize&&"IMG"===i.get(0).tagName&&e.opt.image&&(e._imageControls.$img?e._imageControls.$img.get(0)!==i.get(0)&&(e._imageControls.hide(),setTimeout(function(){return e._imageControls.show(i)},100)):e._imageControls.show(i),e._videoControls.$video&&e._videoControls.hide(),e.opt.inlinePanel&&e._inlineControls.hide(),e._readMore.deactivate())})},_lightenControls:function(){var e=this._lightControls.getList();this.vars.empty||this._controls("light",e),this._readMore.check()},_isEmpty:function(){var e=this,t=this.opt.$el,i=t.find(".js-editor-empty-placeholder").length;i&&t.find(".js-editor-empty-placeholder").remove(),e.vars.empty=!1,0==t.text().replace(/\s/g,"").length&&0==t.find("img").length&&0==t.find("iframe").length&&(e.vars.empty=!0,i?(t.html("<"+e.opt.defaultTag+">&nbsp;</"+e.opt.defaultTag+">"),setTimeout(function(){var e=document.createRange();e.setStart(t.get(0),0),e.setEnd(t.get(0),0),t.get(0).focus()},10)):e.opt.passFFbag===!0||(t.html("&nbsp;"),e._applySelection.text("formatBlock",e.opt.defaultTag.toUpperCase()),e._selection.save(),e._applySelection.text("selectAll"),e._applySelection.text("removeFormat"),e._selection.restore()))},_changeInner:function(){this.opt.changeHtml()},insertPlaceholder:function(e){var t=e.$el;t.find(".js-editor-empty-placeholder").remove(),0==t.text().replace(/\s/g,"").length&&0==t.find("img").length&&0==t.find("iframe").length&&t.html("<"+e.tag+' class="js-editor-empty-placeholder">'+e.placeholder+"</"+e.tag+">")},_controls:function(e,t){var i=this;null!=e&&(i.opt.inlinePanel&&i._inlineControls[e](t),i.opt.additionalPanel&&i._additionalControls[e](t),i.opt.image&&"light"!=e&&i._imageControls[e](t),"light"!=e&&i._videoControls[e](t))},_readMore:{activate:function(e){this.$el=e,this.$el.addClass("active"),f.opt.$el.on("keydown.wysiwygReadMore",function(t){8!=t.keyCode&&46!=t.keyCode||e.remove()})},deactivate:function(){null!=this.$el&&(this.$el.removeClass("active"),f.opt.$el.off("keydown.wysiwygReadMore"),this.$el=null)},check:function(){var e=f.opt.$el.find("hr").length,t=$('[data-val="<hr>"]');e?t.attr("disabled","disabled"):t.removeAttr("disabled")}},_additionalControls:{add:function(){var t=this;f.opt.theme=e.params.siteTheme,s.show({required:["additionalEditor"],templateUrl:"/widgets/wysiwyg/additionalEditor.html",templateData:f.opt,templateCss:["/css/require/widgets/editorAdditional.css"],afterOpen:function(){t.light(f._lightControls.getList())}}),$(document).on("panelClick",function(e,t){if(null==t.dialog){if(f._imageControls.$img&&f._imageControls.$img.length)return;f._applySelection.text(t.cmd,t.val)}else f._dialog[t.dialog]()})},light:function(e){$(document).trigger("lightControls",e)},remove:function(){$(document).off("panelClick"),s.hide()}},_videoControls:{resize:!1,events:!1,setResizing:!1,add:function(){f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-video-controls")),this.$el=$("#ul-editor-video-controls")},show:function(e){this.$video&&(this.hide(),this._imageControls.hide()),this.$video=e,this.light(),f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-video-resize").clone()),this.$resize=$("#ul-editor-video-resize"),this.$el.addClass("editor-visible"),this.position(),this.events||this.addEvents(),this.setResizing||(this.setResize(),this.setResizing=!0)},position:function(){var e=this,t=-5,i=10,o=0,n=e.$video.offset().top-e.$el.height()-i+f.vars.$parent.scrollTop(),s=e.$video.offset().left+e.$video.outerWidth()/2-e.$el.outerWidth()/2,l="bottom";s<f.opt.$el.offset().left&&(o=f.opt.$el.offset().left-s),s+e.$el.outerWidth()>f.opt.$el.offset().left+f.opt.$el.outerWidth()&&(o=f.opt.$el.offset().left+f.opt.$el.outerWidth()-(s+e.$el.outerWidth())),s+=o,e.$video.offset().top<e.$el.height()+i&&(n+=e.$el.height()+e.$video.outerHeight()+2*i,l="top"),t+=-1*o,e.$resize.css({height:e.$video.outerHeight(),width:e.$video.width(),top:e.$video.offset().top+f.vars.$parent.scrollTop(),left:e.$video.offset().left}),e.$el.css({top:n,left:s}),$(".editor-inline-arrow",e.$el).css("margin-left",t).attr("data-gravity",l)},addEvents:function(){var e=this;this.$el.find("button").on("click.wysiwygEvents",function(){e.applyVideo($(this).data("cmd")||$(this).data("dialog"))}),f.opt.$el.on("keydown.videoEvent",function(t){var i=e.$video;return 8!=t.keyCode&&46!=t.keyCode||(e.hide(),i.remove(),f._selection.restore()),!1}),e.events=!0},applyVideo:function(e){var t=this,i={justifyleft:function(){t.$video.css("float","left").css("clear","none"),t.offsets("left")},justifycenter:function(){t.$video.css("float","none").css("clear","both"),t.offsets("none")},justifyright:function(){t.$video.css("float","right").css("clear","none"),t.offsets("right")},remove:function(){var e=t.$video;t.hide(),e.remove(),f._selection.restore()}};i[e]&&i[e](),"remove"!=e&&this.light()},light:function(){if(this.$video.length){$("button",this.$el).removeClass("active");var e=this.$video.css("float");"none"==e&&(e="center"),$('button[data-cmd="justify'+e+'"]',this.$el).addClass("active")}},setResize:function(){var e=this;this.$resize.resizableBootstrap({handles:{nw:".editor-video-resize-tl",ne:".editor-video-resize-tr",sw:".editor-video-resize-bl",se:".editor-video-resize-br"},minWidth:f.opt.imageMinWidth,minHeight:f.opt.imageMinHeight,maxWidth:f.opt.$el.width(),aspectRatio:e.$video.width()/e.$video.outerHeight(),start:function(){e.resize=!0,e.$video.css({width:"100%"})},stop:function(t,i){e.resize=!1,e.$video.css({width:i.size.width}),e.position()},resize:function(){e.position()},alsoResize:e.$video}),this.setResizing=!0},hide:function(){var e=this;this.resize||(this.$el.removeClass("editor-visible"),this.$video=null,setTimeout(function(){e.$el.css({top:"auto",left:"auto"})},100),this.removeEvents())},offsets:function(e,t){var i=!1;null==t&&(t=this.$video,i=!0);var o={none:function(){return f.opt.imageMargin/2+"px auto"},left:function(){return f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px "+f.opt.imageMargin/2+"px 0"},right:function(){return f.opt.imageMargin/2+"px 0 "+f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px"}};t.css("margin",o[e]()),i&&this.position()},removeEvents:function(){this.events&&(this.$el.find("button").off(".wysiwygEvents"),f.opt.$el.off("keydown.videoEvent"),this.events=!1),this.setResizing&&(this.$resize.resizableBootstrap("destroy"),this.$resize.remove(),this.setResizing=!1)},remove:function(){this.removeEvents(),this.$el.remove(),this.$video=null}},_imageControls:{resize:!1,events:!1,setResizing:!1,add:function(){f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-image-controls")),this.$el=$("#ul-editor-image-controls")},addEvents:function(){var e=this;this.$el.find("button").on("click.wysiwygEvents",function(){e.applyImage($(this).data("cmd")||$(this).data("dialog"))}),f.opt.$el.on("keydown.imgEvent",function(t){var i=e.$img;return 8==t.keyCode||46==t.keyCode?(e.hide(),i.remove(),f.opt.removeImg(),f._selection.restore(),!1):!1}),e.events=!0},show:function(e){this.$img&&this._videoControls.hide(),this.$img=e,this.light(),f._selection.clear(),null!=e&&(f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-image-resize").clone()),this.$resize=$("#ul-editor-image-resize"),this.$el.addClass("editor-visible"),this.position(),this.events||this.addEvents(),this.setResizing||(this.setResize(),this.setResizing=!0))},position:function(){var e=this,t=-5,i=10,o=0,n=e.$img.offset().top-e.$el.height()-i+f.vars.$parent.scrollTop(),s=e.$img.offset().left+e.$img.outerWidth()/2-e.$el.outerWidth()/2,l="bottom";s<f.opt.$el.offset().left&&(o=f.opt.$el.offset().left-s),s+e.$el.outerWidth()>f.opt.$el.offset().left+f.opt.$el.outerWidth()&&(o=f.opt.$el.offset().left+f.opt.$el.outerWidth()-(s+e.$el.outerWidth())),s+=o,e.$img.offset().top<e.$el.height()+i&&(n+=e.$el.height()+e.$img.height()+2*i,l="top"),t+=-1*o,e.$resize.css({height:e.$img.height(),width:e.$img.width(),top:e.$img.offset().top+f.vars.$parent.scrollTop(),left:e.$img.offset().left}),e.$el.css({top:n,left:s}),$(".editor-inline-arrow",e.$el).css("margin-left",t).attr("data-gravity",l)},hide:function(){var e=this;this.resize||(this.$el.removeClass("editor-visible"),this.$img=null,setTimeout(function(){e.$el.css({top:"auto",left:"auto"})},100),this.removeEvents())},setResize:function(){var e=this;this.$resize.resizableBootstrap({handles:{nw:".editor-img-resize-tl",ne:".editor-img-resize-tr",sw:".editor-img-resize-bl",se:".editor-img-resize-br"},minWidth:f.opt.imageMinWidth,minHeight:f.opt.imageMinHeight,maxWidth:f.opt.$el.width(),aspectRatio:e.$img.width()/e.$img.height(),start:function(){e.resize=!0,e.$img.css({"max-height":"100%","max-width":"100%"})},stop:function(t,i){e.resize=!1,e.$img.css({height:"100%",width:"100%","max-height":i.size.height,"max-width":i.size.width}),e.position()},resize:function(){e.position()},alsoResize:e.$img}),this.setResizing=!0},applyImage:function(e){var t=this,i={edit:function(){f._dialog.image()},justifyleft:function(){t.$img.attr("align","left"),t.offsets("left")},justifycenter:function(){t.$img.attr("align","none"),t.offsets("none")},justifyright:function(){t.$img.attr("align","right"),t.offsets("right")},link:function(){f._dialog.link()},crop:function(){f._dialog.crop()},remove:function(){var e=t.$img;t.hide(),e.remove(),f._selection.restore(),f.opt.removeImg()}};i[e]&&i[e](),"remove"!=e&&this.light()},light:function(){if(this.$img.length){var e=this.$img.attr("align");$("button",this.$el).removeClass("active"),"A"==this.$img.parent().get(0).tagName&&$('button[data-dialog="link"]',this.$el).addClass("active"),"none"==e&&(e="center"),$('button[data-cmd="justify'+e+'"]',this.$el).addClass("active")}},offsets:function(e,t){var i=!1;null==t&&(t=this.$img,i=!0);var o={none:function(){return f.opt.imageMargin/2+"px auto"},left:function(){return f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px "+f.opt.imageMargin/2+"px 0"},right:function(){return f.opt.imageMargin/2+"px 0 "+f.opt.imageMargin/2+"px "+f.opt.imageMargin+"px"}};t.attr("align",e).css("margin",o[e]()),i&&this.position()},removeEvents:function(){this.events&&(this.$el.find("button").off(".wysiwygEvents"),f.opt.removeImg&&f.opt.$el.off("keydown.imgEvent"),this.events=!1),this.setResizing&&(this.$resize.resizableBootstrap("destroy"),this.$resize.remove(),this.setResizing=!1)},remove:function(){this.removeEvents(),this.$el.remove(),this.$img=null}},_inlineControls:{add:function(){f.vars.$parent.append(f.vars.$renderedControls.find("#ul-editor-inline-controls")),this.$el=$("#ul-editor-inline-controls"),this.addEvents()},addEvents:function(){var e=this;e.$el.on("click.wysiwygEvents",function(t){if(t.target&&"BUTTON"==t.target.tagName){var i=$(t.target),o=i.data("cmd"),n=i.data("dialog"),s=i.data("val");null!=o&&f._applySelection.text(o,s),null!=n&&f._dialog[n]()}else e.hide()})},checkShow:function(){var e,t=f._selection.getSelected();f.opt.inlinePanelFixed?(this.show(),this.position()):null!=t&&(f.opt.select(t),e=t.getBoundingClientRect(),e.width>1&&!f.vars.empty?(this.show(),this.position(e)):this.hide())},show:function(){this.$el.addClass("editor-visible")},hide:function(){var e=this;this.$el.removeClass("editor-visible"),e.$el.css({top:"auto",left:"auto"})},calcPosition:function(e){var t=this,i=10,o=t.$el.height()+i,n=e.top+f.vars.$parent.scrollTop()-5-o,s=e.left-t.$el.outerWidth()/2+e.width/2,l=0,r="bottom";return n-=$("#ul-main").offset().top,s<f.opt.$el.offset().left&&(l=f.opt.$el.offset().left-s),s+t.$el.outerWidth(!0)>f.opt.$el.offset().left+f.opt.$el.outerWidth(!0)&&(l=f.opt.$el.offset().left+f.opt.$el.outerWidth()-(s+t.$el.outerWidth())),s+=l,0>n-i&&(n+=o+e.height+i,r="top"),{top:n,left:s,offset:-1*l,bottomPos:r}},position:function p(e){var p,t=this,i=-5;if(f.opt.inlinePanelFixed){var o=f.opt.$el.offset().top-t.$el.height()-20+f.vars.$parent.scrollTop(),n="bottom";0>o&&(o+=f.opt.$el.height()+t.$el.height()+40,n="top"),p={top:o,left:f.opt.$el.offset().left,offset:-1*(t.$el.width()/2-20),bottomPos:n}}else p=t.calcPosition(e);i+=p.offset,t.$el.width()<f.opt.$el.outerWidth(!0)||f.opt.inlineAlwaysShow?(this.$el.css({top:p.top,left:p.left}),$(".editor-inline-arrow",t.$el).css("margin-left",i).attr("data-gravity",p.bottomPos)):(this.hide(),console.warn("Слишком мало места что бы отобразить инлайновую панель."))},light:function(e){var t=this;$("button",t.$el).removeClass("active"),Object.keys(e).forEach(function(e){var i="cmd";null!=e&&("link"==e&&(i="dialog"),$("button[data-"+i+'="'+e+'"]',t.$el).addClass("active"))})},remove:function(){this.$el.remove()},hideIfNeeded:function(){f.opt.inlinePanel&&!f.opt.inlinePanelFixed&&this.hide()}},_applySelection:{html:function(e,t){var i,o;if(window.getSelection){if(i=window.getSelection(),i.getRangeAt&&i.rangeCount){o=i.getRangeAt(0),o.deleteContents();var n=document.createElement("div");n.innerHTML=e;for(var s,l,r=document.createDocumentFragment();s=n.firstChild;)l=r.appendChild(s);var a=r.firstChild;o.insertNode(r),l&&(o=o.cloneRange(),o.setStartAfter(l),t?o.setStartBefore(a):o.collapse(!0),i.removeAllRanges(),i.addRange(o))}}else if((i=document.selection)&&"Control"!=i.type){var d=i.createRange();d.collapse(!0),i.createRange().pasteHTML(e),t&&(o=i.createRange(),o.setEndPoint("StartToStart",d),o.select())}},text:function(e,t){t=t||null,f.opt.beforeAction(e,t,f._selection.getSelected()),f.opt.$el.focus(),r.opened&&f._selection.restore(),f.opt.clearFormat&&"formatblock"==e&&document.execCommand("removeformat",!1,null),"forecolor"==e?this.color(t):document.execCommand(e,!1,t),f._lightenControls(),f.opt.inlinePanel&&f._inlineControls.checkShow(),f._changeInner(),r.opened&&f._selection.save()},video:function(e){f._selection.restore(),this.html('<p class="video--new" />',!1);var t=$("#js-blog-post-content").find(".video--new");if("js-blog-post-content"!=t.parent().attr("id")){for(var i=t.parent();"js-blog-post-content"!=i.parent().attr("id")&&0!=i.length;)i=i.parent();var o=i.contents().filter(function(){return"BR"!=this.nodeName});1==o.length&&o.eq(0).is(t)?t=i:t.insertAfter(i)}t.removeClass("video--new").addClass("video-inline").attr("data-signature",e.signature).attr("data-html",encodeURIComponent(e.html)).html(e.html)},color:function(e){Object.keys(f.vars.colorClasses).forEach(function(e){f.vars.colorClasses[e].undoToSelection()}),f.vars.colorClasses[e].applyToSelection(),f._changeInner()},image:function(e){var t=f._imageControls.$img;null==t?(this.text("insertImage",e.src),t=$('img[src="'+e.src+'"]:not(.img-responsive)',f.opt.$el),t.addClass("img-responsive"),f._imageControls.offsets("none",t)):(f._imageControls.hide(),t.attr("src",e.src)),t.wrap('<span class="ul-editor-loading-img" style="'+t.attr("style")+'"></span>'),$(".ul-editor-loading-img").css("float",t.attr("align")),t.on("load.imgLoading",function(){setTimeout(function(){f.vars.enabled&&!f._inlineControls.$el.hasClass("editor-visible")&&(f._imageControls.show(t),f._imageControls.light())},100),t.unwrap('<span class="ul-editor-loading-img"></span>').off("load.imgLoading"),f._changeInner()})},link:function(e,t){var i;if(f._selection.restore(),null==f._imageControls.$img)i=f._selection.getFocusNode(),null==e?("A"==i.get(0).tagName&&i.contents().unwrap("<a>"),this.text("unlink",null)):("A"==i.get(0).tagName?i.attr("href",e):(this.text("unlink",null),this.text("createLink",e),i=f._selection.getFocusNode()),t?i.attr("target","_blank"):i.removeAttr("target"),f._selection.clear(),f._inlineControls.hide());else{var o=null==f._imageControls.$img.attr("alt")?"":f._imageControls.$img.attr("alt");null==e?"A"==f._imageControls.$img.parent().get(0).tagName&&f._imageControls.$img.unwrap("<a>"):("A"!=f._imageControls.$img.parent().get(0).tagName&&f._imageControls.$img.wrap("<a>"),f._imageControls.$img.parent().attr("href",e).attr("alt",o),t?f._imageControls.$img.parent().attr("target","_blank"):f._imageControls.$img.parent().removeAttr("target")),f._imageControls.light()}f._changeInner()}},_lightControls:{getList:function(){var e=this,t=f._selection.getFocusNode(),i={};return null!=t&&t.get(0)!=f.opt.$el.get(0)&&(i=$.extend(e.getNodeStyle(t),i),t.parentsUntil(f.opt.$el).map(function(){i=$.extend(e.getNodeStyle($(this)),i)})),i},getNodeStyle:function(e){var t={},i=e.attr("style")||null,o=e.get(0).tagName,n={A:function(){t.link=e.attr("href"),t.$linkEl=e},OL:function(){t.insertorderedlist=""},UL:function(){t.insertunorderedlist=""}},s={"font-style":function(){t.italic=""},"font-weight":function(){t.bold=""},"text-align":function(e){"center"==e?t.justifycenter="":"right"==e?t.justifyright="":"justify"==e?t.justifyfull="":"left"==e&&(t.justifyleft="")},"text-decoration":function(){t.underline=""}};if(f.opt.additionalButtons.tags&&$.inArray(o.toLowerCase(),Object.keys(f.opt.additionalButtons.tags))+1&&(t.formatblock=o.toLowerCase()),f.opt.colors&&f.opt.colors.length&&$.inArray(e.attr("class"),f.opt.colors)+1&&(t.forecolor=e.attr("class")),null!=n[o]&&n[o](),null!=i){var l=i.split(";");l.forEach(function(e){if(e.length>0){e=e.replace(/\s/g,"");var t=e.split(":");s[t[0]]&&s[t[0]](t[1])}})}return t}},_dialog:{insertVideo:function(){new h({callBack:function(e){f._applySelection.video(e)}})},link:function(){var e=null,t=f.opt.$el;f._selection.save(),null!=f._imageControls.$img&&"A"==f._imageControls.$img.parent().get(0).tagName&&(e=f._imageControls.$img.parent().attr("href"),t=f._imageControls.$img.parent()),null!=f._lightControls.getList().link&&(e=f._lightControls.getList().link,t=f._lightControls.getList().$linkEl);var i=t;f._imageControls.$el&&(i=f._imageControls.$el),f._inlineControls.$el.hasClass("editor-visible")&&(i=f._inlineControls.$el),r.open({$targetEl:i,titleShow:!0,title:a("constructor.link"),data:'<div class="ul-editor-link UL ul-sp"></div>',showApplyBtn:!1,showCloseBtn:!1,wide:!1,afterOpen:function(){f._selection.clear(),l.open({$renderedTo:$(".ul-editor-link"),href:e,target:null!=t.attr("target"),applyLink:function(e){e.noClose&&f._applySelection.link(e.link,e.target)}})},beforeClose:function(){l.close()}})},image:function(){g.open({onApply:function(e){f._selection.restore(),f._applySelection.image({src:e.origin})}})},crop:function(){var e=null==f._imageControls.$img?null:f._imageControls.$img.attr("src");n.open({img:e,done:function(e){f._selection.restore(),f._applySelection.image({src:e.data})}})}},_selection:{getFocusNode:function(){return null!=window.getSelection().focusNode?$(window.getSelection().focusNode).parent()||null:void 0},getSelected:function(){var e;if(window.getSelection){var t=window.getSelection();t.getRangeAt&&t.rangeCount&&(e=t.getRangeAt(0))}else document.selection&&document.selection.createRange&&(e=document.selection.createRange());return e},save:function(){this.selected=this.getSelected()},restore:function(){if(this.selected)if(window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.addRange(this.selected)}else document.selection&&this.selected&&this.selected.select();this.selected=null},clear:function(){if(window.getSelection){var e=window.getSelection();if(e.isCollapsed)return;e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges()}document.selection&&document.selection.empty()},setNodeSelecton:function(e){var t=document.createRange();t.selectNode(e);var i=window.getSelection();i.removeAllRanges(),i.addRange(t)}}};return f});
//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map

//# sourceMappingURL=editor.js.map
